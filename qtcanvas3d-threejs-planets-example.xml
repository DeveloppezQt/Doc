<?xml version="1.0" encoding="UTF-8"?>
<db:article xmlns:db="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.2" xml:lang="en">
<db:info>
<db:title>Planets Example</db:title>
<db:productname>QtCanvas3D</db:productname>
<db:edition>Qt 5.12.12 Reference Documentation</db:edition>
<db:titleabbrev>Qt Canvas 3D Reference Documentation</db:titleabbrev>
<db:abstract>
<db:para>Demonstrates combining Qt Quick and three.js rendering.</db:para>
<db:para>This documentation was introduced in QtCanvas3D 1.0.</db:para>
</db:abstract>
<db:pubdate>2024-12-27</db:pubdate>
<db:date>2024-12-27</db:date>
<db:authorgroup>
<db:author>
<db:orgname class="corporation">The Qt Company Ltd.</db:orgname>
</db:author>
</db:authorgroup>
</db:info>
<db:para>The Planets example demonstrates how to implement an application that combines the use of three.js library-based Canvas3D rendering with Qt Quick 2D elements. The example shows the eight planets of our Solar System with the Sun.</db:para>
<db:mediaobject>
<db:imageobject>
<db:imagedata fileref="images/planets-example.jpg"/>
</db:imageobject>
</db:mediaobject>
<db:para>The planets are rotating around the Sun based on their orbit at a given time. The rotation starts at 2000 Jan 0.0 UT. The planet positions are calculated based on the formulas found here: <db:link xlink:href="http://www.stjarnhimlen.se/comp/ppcomp.html">http://www.stjarnhimlen.se/comp/ppcomp.html</db:link> and <db:link xlink:href="http://www.davidcolarusso.com/astro/">http://www.davidcolarusso.com/astro/</db:link>.</db:para>
<db:section xml:id="qt-quick-implementation">
<db:title>Qt Quick Implementation</db:title>
<db:para>The Qt Quick Implementation <db:link xlink:href="">planets.qml</db:link> of the example renders the 3D content using Canvas3D type. The type calls JavaScript code that uses <db:code>three.js</db:code> to initialize, paint, and resize the 3D view.</db:para>
<db:programlisting language="qml">Canvas3D {
    id: canvas3d
    anchors.fill: parent
    onInitializeGL: {
        GLCode.initializeGL(canvas3d, eventSource, mainview);
    }
    onPaintGL: {
        GLCode.paintGL(canvas3d);
        fpsDisplay.fps = canvas3d.fps;
    }

    onResizeGL: {
        GLCode.onResizeGL(canvas3d);
    }
    ControlEventSource {
        anchors.fill: parent
        focus: true
        id: eventSource
    }
}
</db:programlisting>
<db:para>The planet related information is stored into <db:code>ListModel</db:code>. The selection buttons for the planets and the information sheet are created based on the model. The 2D elements, selection buttons and sliders, are implemented in the QML side.</db:para>
<db:para>The selection buttons change the <db:code>focusedPlanet</db:code> property of the mainview. As the property changes the planet information is updated and the camera is animated to the new position. The camera position and the camera look at point are updated based on values that are animated on QML side.</db:para>
<db:programlisting language="qml">onFocusedPlanetChanged: {
    if (focusedPlanet == 100) {
        info.opacity = 0;
        updatePlanetInfo();
    } else {
        updatePlanetInfo();
        info.opacity = 0.5;
    }

    GLCode.prepareFocusedPlanetAnimation();

    lookAtOffsetAnimation.restart();
    cameraOffsetAnimation.restart();
}
</db:programlisting>
<db:para>The sliders are used to adjust the rotation speed, the planet size, and the viewing distance. When the slider value changes, JavaScript code is called to adjust the given property. For example, changing the value of the &quot;Viewing Distance&quot; slider calls the <db:code>setCameraDistence()</db:code> method.</db:para>
<db:programlisting language="qml">onValueChanged: GLCode.setCameraDistance(value);
</db:programlisting>
</db:section>
<db:section xml:id="the-javascript-code">
<db:title>The JavaScript Code</db:title>
<db:para>The JavaScript side of the implementation, <db:link xlink:href="">planets.js</db:link>, is done using a version of <db:code>three.js</db:code> that is ported for <db:link xlink:href="qtcanvas3d-index.xml">Qt Canvas 3D</db:link>: <db:link xlink:href="https://github.com/tronlec/three.js">three.js</db:link>.</db:para>
<db:para>The <db:code>initializeGL()</db:code> method creates the camera and the scene. It also adds the lights to the scene and creates the planet meshes. The Canvas3D renderer needs to be created at initialization phase too.</db:para>
<db:para>Planet texture maps are Copyright (c) by James Hastings-Trew <db:link xlink:href="http://planetpixelemporium.com/planets.html">http://planetpixelemporium.com/planets.html</db:link> used with permission. To calculate the ring geometry for the planets with rings, the <db:code>_RingGeometry()</db:code> method from <db:link xlink:href="https://github.com/jeromeetienne/threex.planets">three.xplanets</db:link> extension is used.</db:para>
<db:para>The scene is rendered in <db:code>paintGL()</db:code> method. That is also the place where the positions for all of the planets are calculated. The planets are rotated based on their axial tilt and their sidereal rotation period. In the <db:code>paintGL()</db:code> method the camera position and look at point are updated based on the focused planet.</db:para>
<db:para>For more information on how to use <db:code>three.js</db:code> the documentation is available here: <db:link xlink:href="http://threejs.org/docs/">three.js/docs</db:link></db:para>
</db:section>
<db:section xml:id="handling-the-mouse-events">
<db:title>Handling the Mouse Events</db:title>
<db:para>In order to handle the mouse event in JavaScript code the Canvas3D type has to include the <db:code>ControlEventSource</db:code> type.</db:para>
<db:programlisting language="qml">ControlEventSource {
    anchors.fill: parent
    focus: true
    id: eventSource
}
</db:programlisting>
<db:para>This type is then passed to the JavaScript code on initialization.</db:para>
<db:programlisting language="qml">onInitializeGL: {
    GLCode.initializeGL(canvas3d, eventSource, mainview);
}
</db:programlisting>
<db:para>On JavaScript code in the <db:code>initializeGL()</db:code> method the <db:code>eventSource</db:code> object is saved to a global variable. In this example <db:code>mouseDown</db:code> event is connected to the <db:code>onDocumentMouseDown()</db:code> method.</db:para>
<db:programlisting language="cpp">eventSource.mouseDown.connect(onDocumentMouseDown);
</db:programlisting>
<db:para>Based on the mouse position variables passed to <db:code>onDocumentMouseDown()</db:code> method, it's checked if the event takes place on top of a planet or not. The focused planet is changed according to the mouse position.</db:para>
</db:section>
<db:section>
<db:title>List of Files</db:title>
<db:para>Files:</db:para>
<db:section>
<db:title>List of Files</db:title>
<db:itemizedlist>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/FpsDisplay.qml">threejs/planets/FpsDisplay.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/InfoSheet.qml">threejs/planets/InfoSheet.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/PlanetButton.qml">threejs/planets/PlanetButton.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/StyledSlider.qml">threejs/planets/StyledSlider.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/main.cpp">threejs/planets/main.cpp</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/planets.js">threejs/planets/planets.js</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/planets.pro">threejs/planets/planets.pro</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/planets.qml">threejs/planets/planets.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/planets.qrc">threejs/planets/planets.qrc</db:link></db:para></db:listitem>
</db:itemizedlist>
</db:section>
<db:section>
<db:title>List of Files</db:title>
<db:para>Images:</db:para>
<db:section>
<db:title>List of Files</db:title>
<db:itemizedlist>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/earth.png">threejs/planets/images/earth.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/earthbump1k.jpg">threejs/planets/images/earthbump1k.jpg</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/earthcloudmapcolortrans.png">threejs/planets/images/earthcloudmapcolortrans.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/earthmap1k.jpg">threejs/planets/images/earthmap1k.jpg</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/earthspec1k.jpg">threejs/planets/images/earthspec1k.jpg</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/galaxy_starfield.png">threejs/planets/images/galaxy_starfield.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/jupiter.png">threejs/planets/images/jupiter.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/jupitermap.jpg">threejs/planets/images/jupitermap.jpg</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/mars.png">threejs/planets/images/mars.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/marsbump1k.jpg">threejs/planets/images/marsbump1k.jpg</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/marsmap1k.jpg">threejs/planets/images/marsmap1k.jpg</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/mercury.png">threejs/planets/images/mercury.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/mercurybump.jpg">threejs/planets/images/mercurybump.jpg</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/mercurymap.jpg">threejs/planets/images/mercurymap.jpg</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/moonbump1k.jpg">threejs/planets/images/moonbump1k.jpg</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/moonmap1k.jpg">threejs/planets/images/moonmap1k.jpg</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/neptune.png">threejs/planets/images/neptune.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/neptunemap.jpg">threejs/planets/images/neptunemap.jpg</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/plutobump1k.jpg">threejs/planets/images/plutobump1k.jpg</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/plutomap1k.jpg">threejs/planets/images/plutomap1k.jpg</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/saturn.png">threejs/planets/images/saturn.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/saturnmap.jpg">threejs/planets/images/saturnmap.jpg</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/saturnringcolortrans.png">threejs/planets/images/saturnringcolortrans.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/sun.png">threejs/planets/images/sun.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/sunmap.jpg">threejs/planets/images/sunmap.jpg</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/uranus.png">threejs/planets/images/uranus.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/uranusmap.jpg">threejs/planets/images/uranusmap.jpg</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/uranusringcolortrans.png">threejs/planets/images/uranusringcolortrans.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/venus.png">threejs/planets/images/venus.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/venusbump.jpg">threejs/planets/images/venusbump.jpg</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/images/venusmap.jpg">threejs/planets/images/venusmap.jpg</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/ios/AppIcon29x29.png">threejs/planets/ios/AppIcon29x29.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/ios/AppIcon29x29@2x.png">threejs/planets/ios/AppIcon29x29@2x.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/ios/AppIcon29x29@2x~ipad.png">threejs/planets/ios/AppIcon29x29@2x~ipad.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/ios/AppIcon29x29~ipad.png">threejs/planets/ios/AppIcon29x29~ipad.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/ios/AppIcon40x40@2x.png">threejs/planets/ios/AppIcon40x40@2x.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/ios/AppIcon40x40@2x~ipad.png">threejs/planets/ios/AppIcon40x40@2x~ipad.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/ios/AppIcon40x40~ipad.png">threejs/planets/ios/AppIcon40x40~ipad.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/ios/AppIcon50x50@2x~ipad.png">threejs/planets/ios/AppIcon50x50@2x~ipad.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/ios/AppIcon50x50~ipad.png">threejs/planets/ios/AppIcon50x50~ipad.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/ios/AppIcon57x57.png">threejs/planets/ios/AppIcon57x57.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/ios/AppIcon57x57@2x.png">threejs/planets/ios/AppIcon57x57@2x.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/ios/AppIcon60x60@2x.png">threejs/planets/ios/AppIcon60x60@2x.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/ios/AppIcon72x72@2x~ipad.png">threejs/planets/ios/AppIcon72x72@2x~ipad.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/ios/AppIcon72x72~ipad.png">threejs/planets/ios/AppIcon72x72~ipad.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/ios/AppIcon76x76@2x~ipad.png">threejs/planets/ios/AppIcon76x76@2x~ipad.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/planets/ios/AppIcon76x76~ipad.png">threejs/planets/ios/AppIcon76x76~ipad.png</db:link></db:para></db:listitem>
</db:itemizedlist>
</db:section>
</db:section></db:section></db:article>
