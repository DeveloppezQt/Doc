<?xml version="1.0" encoding="UTF-8"?>
<db:article xmlns:db="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.2" xml:lang="en">
<db:info>
<db:title>WebEngine Markdown Editor Example</db:title>
<db:productname>QtWebEngine</db:productname>
<db:edition>Qt 5.8.0 Reference Documentation</db:edition>
<db:titleabbrev>Qt WebEngine Reference Documentation</db:titleabbrev>
<db:abstract>
<db:para>Demonstrates how to integrate a web engine in a hybrid desktop application.</db:para>
</db:abstract>
<db:pubdate>2025-06-29</db:pubdate>
<db:date>2025-06-29</db:date>
<db:authorgroup>
<db:author>
<db:orgname class="corporation">The Qt Company Ltd.</db:orgname>
</db:author>
</db:authorgroup>
</db:info>
<db:mediaobject>
<db:imageobject>
<db:imagedata fileref="images/markdowneditor-example.png"/>
</db:imageobject>
</db:mediaobject>
<db:para><db:emphasis>Markdown Editor</db:emphasis> demonstrates how to use <db:link xlink:href="qwebchannel.xml">QWebChannel</db:link> and JavaScript libraries to provide a rich text preview tool for a custom markup language.</db:para>
<db:para><db:link xlink:href="http://daringfireball.net/projects/markdown/">Markdown</db:link> is a lightweight markup language with a plain text formatting syntax. Some services, such as <db:link xlink:href="http://github.com">github</db:link>, acknowledge the format, and render the content as rich text when viewed in a browser.</db:para>
<db:para>The Markdown Editor main window is split into an editor and a preview area. The editor supports the Markdown syntax and is implemented by using <db:link xlink:href="qplaintextedit.xml">QPlainTextEdit</db:link>. The document is rendered as rich text in the preview area, which is implemented by using <db:link xlink:href="qwebengineview.xml">QWebEngineView</db:link>. To render the text, the Markdown text is converted to HTML format with the help of a JavaScript library inside the web engine. The preview is updated from the editor through <db:link xlink:href="qwebchannel.xml">QWebChannel</db:link>.</db:para>
<db:section xml:id="running-the-example">
<db:title>Running the Example</db:title>
<db:para>To run the example from <db:link xlink:href="http://doc.qt.io/qtcreator/index.html">Qt Creator</db:link>, open the <db:emphasis role="bold">Welcome</db:emphasis> mode and select the example from <db:emphasis role="bold">Examples</db:emphasis>. For more information, visit <db:link xlink:href="http://doc.qt.io/qtcreator/creator-build-example-application.html">Building and Running an Example</db:link>.</db:para>
</db:section>
<db:section xml:id="exposing-document-text">
<db:title>Exposing Document Text</db:title>
<db:para>Because we expose the current Markdown text to be rendered to the web engine through <db:link xlink:href="qwebchannel.xml">QWebChannel</db:link>, we need to somehow make the current text available through the Qt metatype system. This is done by using a dedicated <db:code>Document</db:code> class that exposes the document text as a <db:code>Q_PROPERTY</db:code>:</db:para>
<db:programlisting language="cpp">class Document : public QObject
{
    Q_OBJECT
    Q_PROPERTY(QString text MEMBER m_text NOTIFY textChanged)
public:
    explicit Document(QObject *parent = nullptr) : QObject(parent) {}

    void setText(const QString &amp;text);

signals:
    void textChanged(const QString &amp;text);

private:
    QString m_text;
};

</db:programlisting>
<db:para>The <db:code>Document</db:code> class wraps a <db:link xlink:href="qstring.xml">QString</db:link> to be set on the C++ side with the <db:code>setText()</db:code> method and exposes it at runtime as a <db:code>text</db:code> property with a <db:code>textChanged</db:code> signal.</db:para>
<db:para>We define the <db:code>setText</db:code> method as follows:</db:para>
<db:programlisting language="cpp">void Document::setText(const QString &amp;text)
{
    if (text == m_text)
        return;
    m_text = text;
    emit textChanged(m_text);
}

</db:programlisting>
</db:section>
<db:section xml:id="previewing-text">
<db:title>Previewing Text</db:title>
<db:para>We implement our own <db:code>PreviewPage</db:code> class that publicly inherits from <db:code>QWebEnginePage</db:code>:</db:para>
<db:programlisting language="cpp">class PreviewPage : public QWebEnginePage
{
    Q_OBJECT
public:
    explicit PreviewPage(QObject *parent = nullptr) : QWebEnginePage(parent) {}

protected:
    bool acceptNavigationRequest(const QUrl &amp;url, NavigationType type, bool isMainFrame);
};

</db:programlisting>
<db:para>We reimplement the virtual <db:code>acceptNavigationRequest</db:code> method to stop the page from navigating away from the current document. Instead, we redirect external links to the system browser:</db:para>
<db:programlisting language="cpp">bool PreviewPage::acceptNavigationRequest(const QUrl &amp;url,
                                          QWebEnginePage::NavigationType /*type*/,
                                          bool /*isMainFrame*/)
{
    // Only allow qrc:/index.html.
    if (url.scheme() == QString(&quot;qrc&quot;))
        return true;
    QDesktopServices::openUrl(url);
    return false;
}

</db:programlisting>
</db:section>
<db:section xml:id="creating-the-main-window">
<db:title>Creating the Main Window</db:title>
<db:para>The <db:code>MainWindow</db:code> class inherits the <db:link xlink:href="qmainwindow.xml">QMainWindow</db:link> class:</db:para>
<db:programlisting language="cpp">class MainWindow : public QMainWindow
{
    Q_OBJECT

public:
    explicit MainWindow(QWidget *parent = 0);
    ~MainWindow();

    void openFile(const QString &amp;path);

private slots:
    void onFileNew();
    void onFileOpen();
    void onFileSave();
    void onFileSaveAs();
    void onExit();

private:
    bool isModified() const;

    Ui::MainWindow *ui;
    QString m_filePath;
    Document m_content;
};

</db:programlisting>
<db:para>The class declares private slots that match the actions in the menu, as well as the <db:code>isModified()</db:code> helper method.</db:para>
<db:para>The actual layout of the main window is specified in a <db:code>.ui</db:code> file. The widgets and actions are available at runtime in the <db:code>ui</db:code> member variable.</db:para>
<db:para><db:code>m_filePath</db:code> holds the file path to the currently loaded document. <db:code>m_content</db:code> is an instance of the <db:code>Document</db:code> class.</db:para>
<db:para>The actual setup of the different objects is done in the <db:code>MainWindow</db:code> constructor:</db:para>
<db:programlisting language="cpp">MainWindow::MainWindow(QWidget *parent) :
    QMainWindow(parent),
    ui(new Ui::MainWindow)
{
    ui-&gt;setupUi(this);
    ui-&gt;editor-&gt;setFont(QFontDatabase::systemFont(QFontDatabase::FixedFont));
    ui-&gt;preview-&gt;setContextMenuPolicy(Qt::NoContextMenu);

</db:programlisting>
<db:para>The constructor first calls <db:code>setupUi</db:code> to construct the widgets and menu actions according to the UI file. The text editor font is set to one with a fixed character width, and the <db:link xlink:href="qwebengineview.xml">QWebEngineView</db:link> widget is told not to show a context menu.</db:para>
<db:programlisting language="cpp">    PreviewPage *page = new PreviewPage(this);
    ui-&gt;preview-&gt;setPage(page);

</db:programlisting>
<db:para>Here the constructor makes sure our custom <db:code>PreviewPage</db:code> is used by the <db:link xlink:href="qwebengineview.xml">QWebEngineView</db:link> instance in <db:code>ui-&gt;preview</db:code>.</db:para>
<db:programlisting language="cpp">    connect(ui-&gt;editor, &amp;QPlainTextEdit::textChanged,
            [this]() { m_content.setText(ui-&gt;editor-&gt;toPlainText()); });

    QWebChannel *channel = new QWebChannel(this);
    channel-&gt;registerObject(QStringLiteral(&quot;content&quot;), &amp;m_content);
    page-&gt;setWebChannel(channel);

</db:programlisting>
<db:para>Here the <db:code>textChanged</db:code> signal of the editor is connected to a lambda that updates the text in <db:code>m_content</db:code>. This object is then exposed to the JS side by <db:code>QWebChannel</db:code> under the name <db:code>content</db:code>.</db:para>
<db:programlisting language="cpp">    ui-&gt;preview-&gt;setUrl(QUrl(&quot;qrc:/index.html&quot;));

</db:programlisting>
<db:para>Now we can actually load the <db:emphasis>index.html</db:emphasis> file from the resources. For more information about the file, see <db:link xlink:href="qtwebengine-webenginewidgets-markdowneditor-example.xml#creating-an-index-file">Creating an Index File</db:link>.</db:para>
<db:programlisting language="cpp">    connect(ui-&gt;actionNew, &amp;QAction::triggered, this, &amp;MainWindow::onFileNew);
    connect(ui-&gt;actionOpen, &amp;QAction::triggered, this, &amp;MainWindow::onFileOpen);
    connect(ui-&gt;actionSave, &amp;QAction::triggered, this, &amp;MainWindow::onFileSave);
    connect(ui-&gt;actionSaveAs, &amp;QAction::triggered, this, &amp;MainWindow::onFileSaveAs);
    connect(ui-&gt;actionExit, &amp;QAction::triggered, this, &amp;MainWindow::onExit);

    connect(ui-&gt;editor-&gt;document(), &amp;QTextDocument::modificationChanged,
            ui-&gt;actionSave, &amp;QAction::setEnabled);

</db:programlisting>
<db:para>The menu items are connected to the mapping member slots. The <db:guilabel>Save</db:guilabel> item is activated or deactivated depending on whether the user has edited the content.</db:para>
<db:programlisting language="cpp">    QFile defaultTextFile(&quot;:/default.md&quot;);
    defaultTextFile.open(QIODevice::ReadOnly);
    ui-&gt;editor-&gt;setPlainText(defaultTextFile.readAll());
}

</db:programlisting>
<db:para>Finally, we load a default document <db:emphasis>default.md</db:emphasis> from the resources.</db:para>
</db:section>
<db:section xml:id="creating-an-index-file">
<db:title>Creating an Index File</db:title>
<db:programlisting language="cpp">&lt;!doctype html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;head&gt;
  &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;markdown.css&quot;&gt;
  &lt;script src=&quot;marked.min.js&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;qwebchannel.js&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id=&quot;placeholder&quot;&gt;&lt;/div&gt;
  &lt;script&gt;
  'use strict';

  var placeholder = document.getElementById('placeholder');

  var updateText = function(text) {
      placeholder.innerHTML = marked(text);
  }

  new QWebChannel(qt.webChannelTransport,
    function(channel) {
      var content = channel.objects.content;
      updateText(content.text);
      content.textChanged.connect(updateText);
    }
  );
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;

</db:programlisting>
<db:para>In the <db:emphasis>index.html</db:emphasis>, we load a custom stylesheet and two JavaScript libraries. <db:link xlink:href="http://kevinburke.bitbucket.org/markdowncss/">markdown.css</db:link> is a markdown-friendly stylesheet created by Kevin Burke. <db:link xlink:href="https://github.com/chjj/marked">marked.min.js</db:link> is a markdown parser and compiler designed for speed written by Christopher Jeffrey and <db:emphasis>qwebchannel.js</db:emphasis> is part of the <db:link xlink:href="qwebchannel.xml">QWebChannel</db:link> module.</db:para>
<db:para>In the <db:code>&lt;body&gt;</db:code> element we first define a <db:code>placeholder</db:code> element, and make it available as a JavaScript variable. We then define the <db:code>updateText</db:code> helper method that updates the content of <db:code>placeholder</db:code> with the HTML that the JavaScript method <db:code>marked()</db:code> returns.</db:para>
<db:para>Finally, we set up the web channel to access the <db:code>content</db:code> proxy object and make sure that <db:code>updateText()</db:code> is called whenever <db:code>content.text</db:code> changes.</db:para>
</db:section>
<db:section>
<db:title>List of Files</db:title>
<db:para>Files:</db:para>
<db:section>
<db:title>List of Files</db:title>
<db:itemizedlist>
<db:listitem>
<db:para><db:link xlink:href="webenginewidgets/markdowneditor/document.cpp">webenginewidgets/markdowneditor/document.cpp</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="webenginewidgets/markdowneditor/document.h">webenginewidgets/markdowneditor/document.h</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="webenginewidgets/markdowneditor/main.cpp">webenginewidgets/markdowneditor/main.cpp</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="webenginewidgets/markdowneditor/mainwindow.cpp">webenginewidgets/markdowneditor/mainwindow.cpp</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="webenginewidgets/markdowneditor/mainwindow.h">webenginewidgets/markdowneditor/mainwindow.h</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="webenginewidgets/markdowneditor/mainwindow.ui">webenginewidgets/markdowneditor/mainwindow.ui</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="webenginewidgets/markdowneditor/markdowneditor.pro">webenginewidgets/markdowneditor/markdowneditor.pro</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="webenginewidgets/markdowneditor/previewpage.cpp">webenginewidgets/markdowneditor/previewpage.cpp</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="webenginewidgets/markdowneditor/previewpage.h">webenginewidgets/markdowneditor/previewpage.h</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="webenginewidgets/markdowneditor/resources/markdown.css">webenginewidgets/markdowneditor/resources/markdown.css</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="webenginewidgets/markdowneditor/resources/markdowneditor.qrc">webenginewidgets/markdowneditor/resources/markdowneditor.qrc</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="webenginewidgets/markdowneditor/resources/marked.min.js">webenginewidgets/markdowneditor/resources/marked.min.js</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="webenginewidgets/markdowneditor/resources/qwebchannel.js">webenginewidgets/markdowneditor/resources/qwebchannel.js</db:link></db:para></db:listitem>
</db:itemizedlist>
</db:section>
</db:section></db:article>
