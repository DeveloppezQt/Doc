<?xml version="1.0" encoding="UTF-8"?>
<db:article xmlns:db="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.2" xml:lang="en">
<db:info>
<db:title>Implementing Atomic Operations</db:title>
<db:productname>QtDoc</db:productname>
<db:edition>Qt 5.13.2 Reference Documentation</db:edition>
<db:titleabbrev>Qt Reference Documentation</db:titleabbrev>
<db:abstract>
<db:para>A guide to implementing atomic operations on new architectures.</db:para>
</db:abstract>
<db:pubdate>2024-12-27</db:pubdate>
<db:date>2024-12-27</db:date>
<db:authorgroup>
<db:author>
<db:orgname class="corporation">The Qt Company Ltd.</db:orgname>
</db:author>
</db:authorgroup>
</db:info>
<db:para>Qt uses an optimization called <db:link xlink:href="shared.xml">implicit sharing</db:link> for many of its value classes.</db:para>
<db:para>Starting with Qt 4, all of Qt's implicitly shared classes can safely be copied across threads like any other value classes, i.e., they are fully <db:link xlink:href="threads-reentrancy.xml">reentrant</db:link>. This is accomplished by implementing reference counting operations using atomic hardware instructions on all the different platforms supported by Qt.</db:para>
<db:para>To support a new architecture, it is important to ensure that these platform-specific atomic operations are implemented in a corresponding header file (qatomic_ARCH.h), and that this file is located in Qt's src/corelib/arch directory. For example, the Intel 80386 implementation is located in src/corelib/arch/qatomic_i386.h.</db:para>
<db:para>Currently, Qt provides two classes providing several atomic operations, <db:link xlink:href="qatomicint.xml">QAtomicInt</db:link> and <db:link xlink:href="qatomicpointer.xml">QAtomicPointer</db:link>. These classes inherit from QBasicAtomicInt and QBasicAtomicPointer, respectively.</db:para>
<db:para>When porting Qt to a new architecture, the QBasicAtomicInt and QBasicAtomicPointer classes must be implemented, <db:emphasis>not</db:emphasis> <db:link xlink:href="qatomicint.xml">QAtomicInt</db:link> and <db:link xlink:href="qatomicpointer.xml">QAtomicPointer</db:link>. The former classes do not have constructors, which makes them POD (plain-old-data). Both classes only have a single member variable called _q_value, which stores the value. This is the value that all of the atomic operations read and modify.</db:para>
<db:para>All of the member functions mentioned in the <db:link xlink:href="qatomicint.xml">QAtomicInt</db:link> and <db:link xlink:href="qatomicpointer.xml">QAtomicPointer</db:link> API documentation must be implemented. Note that these the implementations of the atomic operations in these classes must be atomic with respect to both interrupts and multiple processors.</db:para>
<db:warning>
<db:para>The QBasicAtomicInt and QBasicAtomicPointer classes mentioned in this document are used internally by Qt and are not part of the public API. They may change in future versions of Qt. The purpose of this document is to aid people interested in porting Qt to a new architecture.</db:para>
</db:warning>
</db:article>
