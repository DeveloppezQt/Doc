<?xml version="1.0" encoding="UTF-8"?>
<db:article xmlns:db="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.2" xml:lang="en">
<db:info>
<db:title>QML Video Example</db:title>
<db:productname>QtMultimedia</db:productname>
<db:edition>Qt 5.12.12 Reference Documentation</db:edition>
<db:titleabbrev>Qt Multimedia Documentation</db:titleabbrev>
<db:abstract>
<db:para>Transforming video and camera viewfinder content.</db:para>
</db:abstract>
<db:pubdate>2024-12-27</db:pubdate>
<db:date>2024-12-27</db:date>
<db:authorgroup>
<db:author>
<db:orgname class="corporation">The Qt Company Ltd.</db:orgname>
</db:author>
</db:authorgroup>
</db:info>
<db:para><db:emphasis>QML Video</db:emphasis> demonstrates the various transformations (move; resize; rotate; change aspect ratio) that can be applied to QML <db:link xlink:href="qml-qtmultimedia-videooutput.xml">VideoOutput</db:link> and <db:link xlink:href="qml-qtmultimedia-camera.xml">Camera</db:link> types.</db:para>
<db:para>It also shows how native code can be combined with QML to implement more advanced functionality - in this case, C++ code is used to calculate the QML frame rate. This value is rendered in QML in a semi-transparent item overlaid on the video content.</db:para>
<db:para>The following image shows the application executing the video-overlay scene, which creates a dummy overlay item (just a semi-transparent <db:link xlink:href="qml-qtquick-rectangle.xml">Rectangle</db:link>), which moves across the <db:link xlink:href="qml-qtmultimedia-videooutput.xml">VideoOutput</db:link> item.</db:para>
<db:mediaobject>
<db:imageobject>
<db:imagedata fileref="images/qmlvideo-overlay.jpg"/>
</db:imageobject>
</db:mediaobject>
<db:section xml:id="running-the-example">
<db:title>Running the Example</db:title>
<db:para>To run the example from <db:link xlink:href="http://doc.qt.io/qtcreator/index.html">Qt Creator</db:link>, open the <db:emphasis role="bold">Welcome</db:emphasis> mode and select the example from <db:emphasis role="bold">Examples</db:emphasis>. For more information, visit <db:link xlink:href="http://doc.qt.io/qtcreator/creator-build-example-application.html">Building and Running an Example</db:link>.</db:para>
</db:section>
<db:section xml:id="application-structure">
<db:title>Application Structure</db:title>
<db:para>The <db:link xlink:href="">multimedia/video/qmlvideo/qml/qmlvideo/main.qml</db:link> file creates a UI which includes the following items:</db:para>
<db:itemizedlist>
<db:listitem>
<db:para>Two Button instances, each of which displays a filename, and can be used to launch a FileBrowser</db:para>
</db:listitem>
<db:listitem>
<db:para>An exit Button</db:para>
</db:listitem>
<db:listitem>
<db:para>A SceneSelectionPanel, which is a flickable list displaying the available scenes</db:para>
</db:listitem>
<db:listitem>
<db:para>At the lower left, an item which displays the QML repainting rate - the upper number is the instantaneous frame rate and the lower number is the average over the past second.</db:para>
</db:listitem>
</db:itemizedlist>
<db:mediaobject>
<db:imageobject>
<db:imagedata fileref="images/qmlvideo-menu.jpg"/>
</db:imageobject>
</db:mediaobject>
<db:para>Each scene in the flickable list is implemented in its own QML file - for example the video-basic scene (which just displays a static <db:link xlink:href="qml-qtmultimedia-videooutput.xml">VideoOutput</db:link> in the center of the screen) is implemented in the <db:link xlink:href="">VideoBasic.qml</db:link> file. As you can see from the code, this makes use of a type of inheritance: a VideoBasic item ...</db:para>
<db:programlisting language="cpp">import QtQuick 2.0

SceneBasic {
    contentType: &quot;video&quot;
}
</db:programlisting>
<db:para>... is-a SceneBasic ...</db:para>
<db:programlisting language="cpp">import QtQuick 2.0

Scene {
    id: root
    property string contentType
    ...
    Content {
        id: content
    ...
    }

    Text {
        anchors {
            horizontalCenter: parent.horizontalCenter
            bottom: parent.bottom
            margins: 20
        }
        text: content.started ? &quot;Tap the screen to stop content&quot;
                              : &quot;Tap the screen to start content&quot;
        color: &quot;#e0e0e0&quot;
        z: 2.0
    }

    MouseArea {
        anchors.fill: parent
        onClicked: {
            if (content.started)
                content.stop()
            else
                content.start()
        }
    }

    Component.onCompleted: root.content = content
}
</db:programlisting>
<db:para>... which is-a Scene:</db:para>
<db:programlisting language="cpp">import QtQuick 2.0

Rectangle {
    id: root
    ...
    property QtObject content
    ...
    Button {
        id: closeButton
        anchors {
            top: parent.top
            right: parent.right
            margins: root.margins
        }
        width: Math.max(parent.width, parent.height) / 12
        height: Math.min(parent.width, parent.height) / 12
        z: 2.0
        bgColor: &quot;#212121&quot;
        bgColorSelected: &quot;#757575&quot;
        textColorSelected: &quot;white&quot;
        text: &quot;Back&quot;
        onClicked: root.close()
    }
}
</db:programlisting>
<db:para>SceneBasic describes the structure and behaviour of the scene, but is agnostic of the type of content which will be displayed - this is abstracted by Content.</db:para>
<db:para>This pattern allows us to define a particular use case (in this case, simply display a static piece of content), and then instantiate that use case for both video content (VideoBasic) and camera content (CameraBasic). This approach is used to implement many of the other scenes - for example, &quot;repeatedly slide the content from left to right and back again&quot; is implemented by SceneMove, on which VideoMove and CameraMove are based.</db:para>
<db:para>Depending on the value of the contentType property in the top-level scene instance, the embedded Content item creates either a <db:link xlink:href="qml-qtmultimedia-mediaplayer.xml">MediaPlayer</db:link> or a <db:link xlink:href="qml-qtmultimedia-camera.xml">Camera</db:link> item.</db:para>
</db:section>
<db:section xml:id="calculating-and-displaying-qml-painting-rate">
<db:title>Calculating and Displaying QML Painting Rate</db:title>
<db:para>The QML painting rate is calculated by the FrequencyMonitor class, which turns a stream of events (received via the notify() slot), into an instantaneous and an averaged frequency:</db:para>
<db:programlisting language="cpp">class FrequencyMonitor : public QObject
{
    Q_OBJECT
    Q_PROPERTY(qreal instantaneousFrequency READ instantaneousFrequency NOTIFY instantaneousFrequencyChanged)
    Q_PROPERTY(qreal averageFrequency READ averageFrequency NOTIFY averageFrequencyChanged)

public:
    ...
    static void qmlRegisterType();

public slots:
    Q_INVOKABLE void notify();
};
</db:programlisting>
<db:para>The FrequencyMonitor class is exposed to QML like this</db:para>
<db:programlisting language="cpp">void FrequencyMonitor::qmlRegisterType()
{
    ::qmlRegisterType&amp;lt;FrequencyMonitor&amp;gt;(&quot;FrequencyMonitor&quot;, 1, 0, &quot;FrequencyMonitor&quot;);
}
</db:programlisting>
<db:para>and its data is displayed by defining a QML item called FrequencyItem, like this:</db:para>
<db:programlisting language="cpp">import FrequencyMonitor 1.0

Rectangle {
    id: root
    ...
    function notify() {
        monitor.notify()
    }

    FrequencyMonitor {
        id: monitor
        onAverageFrequencyChanged: {
            averageFrequencyText.text = monitor.averageFrequency.toFixed(2)
        }
    }

    Text {
        id: labelText
        anchors {
            left: parent.left
            top: parent.top
            margins: 10
        }
        color: root.textColor
        font.pixelSize: 0.6 * root.textSize
        text: root.label
        width: root.width - 2*anchors.margins
        elide: Text.ElideRight
    }

    Text {
        id: averageFrequencyText
        anchors {
            right: parent.right
            bottom: parent.bottom
            margins: 10
        }
        color: root.textColor
        font.pixelSize: root.textSize
    }
}
</db:programlisting>
<db:para>The result looks like this:</db:para>
<db:mediaobject>
<db:imageobject>
<db:imagedata fileref="images/video-qml-paint-rate.png"/>
</db:imageobject>
</db:mediaobject>
<db:para>All that remains is to connect the afterRendering() signal of the <db:link xlink:href="qquickview.xml">QQuickView</db:link> object to a JavaScript function, which will eventually call frequencyItem.notify():</db:para>
<db:programlisting language="cpp">#include &amp;lt;QtGui/QGuiApplication&amp;gt;
#include &amp;lt;QtQuick/QQuickItem&amp;gt;
#include &amp;lt;QtQuick/QQuickView&amp;gt;
#include &quot;trace.h&quot;

#ifdef PERFORMANCEMONITOR_SUPPORT
#include &quot;performancemonitordeclarative.h&quot;
#endif

static const QString DefaultFileName1 = &quot;&quot;;
    ...
    QQuickItem *rootObject = viewer.rootObject();
    ...
    QObject::connect(&amp;amp;viewer, SIGNAL(afterRendering()),
                     rootObject, SLOT(qmlFramePainted()));
</db:programlisting>
</db:section>
<db:section>
<db:title>List of Files</db:title>
<db:para>Files:</db:para>
<db:section>
<db:title>List of Files</db:title>
<db:itemizedlist>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/main.cpp">multimedia/video/qmlvideo/main.cpp</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/Button.qml">multimedia/video/qmlvideo/qml/qmlvideo/Button.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/CameraBasic.qml">multimedia/video/qmlvideo/qml/qmlvideo/CameraBasic.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/CameraDrag.qml">multimedia/video/qmlvideo/qml/qmlvideo/CameraDrag.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/CameraDummy.qml">multimedia/video/qmlvideo/qml/qmlvideo/CameraDummy.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/CameraFullScreen.qml">multimedia/video/qmlvideo/qml/qmlvideo/CameraFullScreen.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/CameraFullScreenInverted.qml">multimedia/video/qmlvideo/qml/qmlvideo/CameraFullScreenInverted.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/CameraItem.qml">multimedia/video/qmlvideo/qml/qmlvideo/CameraItem.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/CameraMove.qml">multimedia/video/qmlvideo/qml/qmlvideo/CameraMove.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/CameraOverlay.qml">multimedia/video/qmlvideo/qml/qmlvideo/CameraOverlay.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/CameraResize.qml">multimedia/video/qmlvideo/qml/qmlvideo/CameraResize.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/CameraRotate.qml">multimedia/video/qmlvideo/qml/qmlvideo/CameraRotate.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/CameraSpin.qml">multimedia/video/qmlvideo/qml/qmlvideo/CameraSpin.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/Content.qml">multimedia/video/qmlvideo/qml/qmlvideo/Content.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/ErrorDialog.qml">multimedia/video/qmlvideo/qml/qmlvideo/ErrorDialog.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/FileBrowser.qml">multimedia/video/qmlvideo/qml/qmlvideo/FileBrowser.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/Scene.qml">multimedia/video/qmlvideo/qml/qmlvideo/Scene.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/SceneBasic.qml">multimedia/video/qmlvideo/qml/qmlvideo/SceneBasic.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/SceneDrag.qml">multimedia/video/qmlvideo/qml/qmlvideo/SceneDrag.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/SceneFullScreen.qml">multimedia/video/qmlvideo/qml/qmlvideo/SceneFullScreen.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/SceneFullScreenInverted.qml">multimedia/video/qmlvideo/qml/qmlvideo/SceneFullScreenInverted.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/SceneMove.qml">multimedia/video/qmlvideo/qml/qmlvideo/SceneMove.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/SceneMulti.qml">multimedia/video/qmlvideo/qml/qmlvideo/SceneMulti.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/SceneOverlay.qml">multimedia/video/qmlvideo/qml/qmlvideo/SceneOverlay.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/SceneResize.qml">multimedia/video/qmlvideo/qml/qmlvideo/SceneResize.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/SceneRotate.qml">multimedia/video/qmlvideo/qml/qmlvideo/SceneRotate.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/SceneSelectionPanel.qml">multimedia/video/qmlvideo/qml/qmlvideo/SceneSelectionPanel.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/SceneSpin.qml">multimedia/video/qmlvideo/qml/qmlvideo/SceneSpin.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/SeekControl.qml">multimedia/video/qmlvideo/qml/qmlvideo/SeekControl.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/VideoBasic.qml">multimedia/video/qmlvideo/qml/qmlvideo/VideoBasic.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/VideoDrag.qml">multimedia/video/qmlvideo/qml/qmlvideo/VideoDrag.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/VideoDummy.qml">multimedia/video/qmlvideo/qml/qmlvideo/VideoDummy.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/VideoFillMode.qml">multimedia/video/qmlvideo/qml/qmlvideo/VideoFillMode.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/VideoFullScreen.qml">multimedia/video/qmlvideo/qml/qmlvideo/VideoFullScreen.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/VideoFullScreenInverted.qml">multimedia/video/qmlvideo/qml/qmlvideo/VideoFullScreenInverted.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/VideoItem.qml">multimedia/video/qmlvideo/qml/qmlvideo/VideoItem.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/VideoMetadata.qml">multimedia/video/qmlvideo/qml/qmlvideo/VideoMetadata.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/VideoMove.qml">multimedia/video/qmlvideo/qml/qmlvideo/VideoMove.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/VideoOverlay.qml">multimedia/video/qmlvideo/qml/qmlvideo/VideoOverlay.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/VideoPlaybackRate.qml">multimedia/video/qmlvideo/qml/qmlvideo/VideoPlaybackRate.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/VideoResize.qml">multimedia/video/qmlvideo/qml/qmlvideo/VideoResize.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/VideoRotate.qml">multimedia/video/qmlvideo/qml/qmlvideo/VideoRotate.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/VideoSeek.qml">multimedia/video/qmlvideo/qml/qmlvideo/VideoSeek.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/VideoSpin.qml">multimedia/video/qmlvideo/qml/qmlvideo/VideoSpin.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qml/qmlvideo/main.qml">multimedia/video/qmlvideo/qml/qmlvideo/main.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qmlvideo.pro">multimedia/video/qmlvideo/qmlvideo.pro</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qmlvideo.qrc">multimedia/video/qmlvideo/qmlvideo.qrc</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qmlvideo.svg">multimedia/video/qmlvideo/qmlvideo.svg</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/trace.h">multimedia/video/qmlvideo/trace.h</db:link></db:para></db:listitem>
</db:itemizedlist>
</db:section>
<db:section>
<db:title>List of Files</db:title>
<db:para>Images:</db:para>
<db:section>
<db:title>List of Files</db:title>
<db:itemizedlist>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/images/folder.png">multimedia/video/qmlvideo/images/folder.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/images/leaves.jpg">multimedia/video/qmlvideo/images/leaves.jpg</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/images/up.png">multimedia/video/qmlvideo/images/up.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="multimedia/video/qmlvideo/qmlvideo.png">multimedia/video/qmlvideo/qmlvideo.png</db:link></db:para></db:listitem>
</db:itemizedlist>
</db:section>
</db:section></db:section></db:article>
