<?xml version="1.0" encoding="UTF-8"?>
<db:article xmlns:db="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.2" xml:lang="en">
<db:info>
<db:title>Interactive Mobile Phone Example</db:title>
<db:productname>QtCanvas3D</db:productname>
<db:edition>Qt 5.6.3 Reference Documentation</db:edition>
<db:titleabbrev>Qt Canvas 3D Reference Documentation</db:titleabbrev>
<db:abstract>
<db:para>Demonstrates using Qt Quick item as a texture with three.js.</db:para>
<db:para>This documentation was introduced in QtCanvas3D 1.1.</db:para>
</db:abstract>
<db:pubdate>2025-06-29</db:pubdate>
<db:date>2025-06-29</db:date>
<db:authorgroup>
<db:author>
<db:orgname class="corporation">The Qt Company Ltd.</db:orgname>
</db:author>
</db:authorgroup>
</db:info>
<db:para>This example demonstrates how to implement an application that uses Qt Quick 2D element as a texture in a three.js scene. The example shows a 3D model of a mobile phone with an UI implemented with Qt Quick. When the phone is not rotating, the UI can be interacted with.</db:para>
<db:mediaobject>
<db:imageobject>
<db:imagedata fileref="images/cellphone-example.png"/>
</db:imageobject>
</db:mediaobject>
<db:section xml:id="qt-quick-implementation">
<db:title>Qt Quick Implementation</db:title>
<db:para>The Qt Quick Implementation <db:link xlink:href="">main.qml</db:link> of the example renders the 3D model of the mobile phone using <db:link xlink:href="qml-qtcanvas3d-canvas3d.xml">Canvas3D</db:link> type. The phone UI is composed of the <db:code>textureSource</db:code> Qt Quick item and its children. To make it possible to use the item as a texture source for <db:link xlink:href="qml-qtcanvas3d-canvas3d.xml">Canvas3D</db:link>, we must enable the layer of the item:</db:para>
<db:programlisting language="qml">Item {
    id: textureSource
    layer.enabled: true
    layer.smooth: true
    layer.textureMirroring: ShaderEffectSource.NoMirroring
    ...
</db:programlisting>
<db:para>The texture mirroring is disabled so that the OpenGL texture generated from the item is oriented as the three.js expects.</db:para>
<db:para>The <db:code>textureSource</db:code> item is passed as a parameter to the JavaScript function handling the OpenGL initialization in <db:link xlink:href="qml-qtcanvas3d-canvas3d.xml">Canvas3D</db:link>:</db:para>
<db:programlisting language="qml">onInitializeGL: GLCode.initializeGL(canvas3d, textureSource)
</db:programlisting>
<db:para>The texture generated from the <db:code>textureSource</db:code> is not interactable by itself, as it is just a regular texture. To make it appear interactable, we make it so that the phone UI is interactable only when the phone is not rotating and superimpose the actual <db:code>textureSource</db:code> item over the <db:link xlink:href="qml-qtcanvas3d-canvas3d.xml">Canvas3D</db:link> so that both the 3D model and the <db:code>textureSource</db:code> items are perfectly aligned. The 3D model and the Qt Quick UI are aligned by careful positioning of the model and scaling of the <db:code>textureSource</db:code> item using its <db:link xlink:href="qml-qtquick-item.xml#transform-prop">transform</db:link> property. The <db:code>textureSource</db:code> item is set fully transparent so that there are no visual artifacts:</db:para>
<db:programlisting language="qml">transform: [
    Scale {
        origin.y: textureSource.height / 2
        origin.x: textureSource.width / 2
        yScale: 0.5 * mainView.height / mainView.initialHeight
        xScale: 0.5 * mainView.height / mainView.initialHeight
    }
]
opacity: 0.0
</db:programlisting>
<db:para>To ensure user cannot interact with the UI when the phone is rotating, we hide the <db:code>textureSource</db:code> item behind the <db:link xlink:href="qml-qtcanvas3d-canvas3d.xml">Canvas3D</db:link> by adjusting its <db:link xlink:href="qml-qtquick-item.xml#z-prop">z</db:link> property when the phone starts its rotation animation.</db:para>
</db:section>
<db:section xml:id="the-javascript-code">
<db:title>The JavaScript Code</db:title>
<db:para>The JavaScript side of the implementation, <db:link xlink:href="">cellphone.js</db:link>, is done using a version of <db:code>three.js</db:code> that is ported for <db:link xlink:href="qtcanvas3d-index.xml">Qt Canvas 3D</db:link>: <db:link xlink:href="https://github.com/tronlec/three.js">three.js</db:link>.</db:para>
<db:para>The <db:code>initializeGL()</db:code> method creates the scene. It also adds the lights and the camera to the scene and creates materials and meshes used in the scene. The part relevant to the main point of this example is how the <db:code>textureSource</db:code> is handled. It is very simple to create a texture from a Qt Quick texture source: simply create a new <db:code>THREE.QtQuickItemTexture</db:code> with the <db:code>textureSource</db:code> as a parameter and you are done:</db:para>
<db:programlisting language="cpp">var frontTexture = new THREE.QtQuickItemTexture( textureSource );
</db:programlisting>
<db:para>The texture created this way can be used as a map to a material just like a regular texture:</db:para>
<db:programlisting language="cpp">var frontMaterial = new THREE.MeshPhongMaterial( { map: frontTexture } );
</db:programlisting>
<db:para>The scene is rendered in <db:code>paintGL()</db:code> method, which simply adjusts the rotations of the phone meshes, repositions the camera and light, and renders the scene.</db:para>
<db:para>For more information on how to use <db:code>three.js</db:code> the documentation is available here: <db:link xlink:href="http://threejs.org/docs/">three.js/docs</db:link></db:para>
<db:para>The background sphere uses Pluto texture map, which is Copyright (c) by James Hastings-Trew <db:link xlink:href="http://planetpixelemporium.com/planets.html">http://planetpixelemporium.com/planets.html</db:link>. Used with permission.</db:para>
</db:section>
<db:section>
<db:title>List of Files</db:title>
<db:para>Files:</db:para>
<db:section>
<db:title>List of Files</db:title>
<db:itemizedlist>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/cellphone.pro">threejs/cellphone/cellphone.pro</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/cellphone.qrc">threejs/cellphone/cellphone.qrc</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/main.cpp">threejs/cellphone/main.cpp</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/qml/cellphone/cellphone.js">threejs/cellphone/qml/cellphone/cellphone.js</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/qml/cellphone/cellphoneapp.qml">threejs/cellphone/qml/cellphone/cellphoneapp.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/qml/cellphone/cellphonecanvas.qml">threejs/cellphone/qml/cellphone/cellphonecanvas.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/qml/cellphone/colorselector.qml">threejs/cellphone/qml/cellphone/colorselector.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/qml/cellphone/fpsdisplay.qml">threejs/cellphone/qml/cellphone/fpsdisplay.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/qml/cellphone/main.qml">threejs/cellphone/qml/cellphone/main.qml</db:link></db:para></db:listitem>
</db:itemizedlist>
</db:section>
<db:section>
<db:title>List of Files</db:title>
<db:para>Images:</db:para>
<db:section>
<db:title>List of Files</db:title>
<db:itemizedlist>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/images/calendar.png">threejs/cellphone/images/calendar.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/images/camera.png">threejs/cellphone/images/camera.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/images/clock.png">threejs/cellphone/images/clock.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/images/contacts.png">threejs/cellphone/images/contacts.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/images/gallery.png">threejs/cellphone/images/gallery.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/images/games.png">threejs/cellphone/images/games.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/images/lock.png">threejs/cellphone/images/lock.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/images/mail.png">threejs/cellphone/images/mail.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/images/maps.png">threejs/cellphone/images/maps.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/images/menu_background.jpg">threejs/cellphone/images/menu_background.jpg</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/images/music.png">threejs/cellphone/images/music.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/images/plutomap1k.jpg">threejs/cellphone/images/plutomap1k.jpg</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/images/qtlogo_with_alpha.png">threejs/cellphone/images/qtlogo_with_alpha.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/images/settings.png">threejs/cellphone/images/settings.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/images/todo.png">threejs/cellphone/images/todo.png</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="threejs/cellphone/images/videos.png">threejs/cellphone/images/videos.png</db:link></db:para></db:listitem>
</db:itemizedlist>
</db:section>
</db:section></db:section></db:article>
