<?xml version="1.0" encoding="UTF-8"?>
<db:article xmlns:db="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.2" xml:lang="en">
<db:info>
<db:title>Places Map (QML)</db:title>
<db:productname>QtLocation</db:productname>
<db:edition>Qt 5.12.12 Reference Documentation</db:edition>
<db:titleabbrev>Qt Location Reference Documentation</db:titleabbrev>
<db:abstract>
<db:para>The Places Map example demonstrates how to search for and display a list of places on a map using a <db:link xlink:href="qml-qtlocation-mapitemview.xml">MapItemView</db:link>.</db:para>
</db:abstract>
<db:pubdate>2024-12-27</db:pubdate>
<db:date>2024-12-27</db:date>
<db:authorgroup>
<db:author>
<db:orgname class="corporation">The Qt Company Ltd.</db:orgname>
</db:author>
</db:authorgroup>
</db:info>
<db:mediaobject>
<db:imageobject>
<db:imagedata fileref="images/places_map.png"/>
</db:imageobject>
</db:mediaobject>
<db:para>The example displays a map of the current location or, if no position is available, it uses Brisbane/Australia. Subsequently a search for places matching the term &quot;pizza&quot; is performed and each result shown on the map.</db:para>
<db:section xml:id="running-the-example">
<db:title>Running the Example</db:title>
<db:para>To run the example from <db:link xlink:href="http://doc.qt.io/qtcreator/index.html">Qt Creator</db:link>, open the <db:emphasis role="bold">Welcome</db:emphasis> mode and select the example from <db:emphasis role="bold">Examples</db:emphasis>. For more information, visit <db:link xlink:href="http://doc.qt.io/qtcreator/creator-build-example-application.html">Building and Running an Example</db:link>.</db:para>
</db:section>
<db:section xml:id="local-search">
<db:title>Local Search</db:title>
<db:para>To write the QML application that will show places on a map, we start by making the following import declarations.</db:para>
<db:programlisting language="qml">import QtQuick 2.0
import QtPositioning 5.5
import QtLocation 5.6
</db:programlisting>
<db:para>Instantiate a <db:link xlink:href="qmake-common-projects.xml#plugin">Plugin</db:link> instance. The <db:link xlink:href="qmake-common-projects.xml#plugin">Plugin</db:link> is effectively the backend from where places are sourced from. Depending on the chosen plugin some manadatory parameters may be needed. In this case the <db:link xlink:href="location-plugin-osm.xml">OSM plugin</db:link> is selected which does not have any mandatory parameters.</db:para>
<db:programlisting language="qml">Plugin {
    id: myPlugin
    name: &quot;osm&quot; // &quot;mapboxgl&quot;, &quot;esri&quot;, ...
    //specify plugin parameters if necessary
    //PluginParameter {...}
    //PluginParameter {...}
    //...
}
</db:programlisting>
<db:para>Next we instantiate a <db:link xlink:href="qml-qtlocation-placesearchmodel.xml">PlaceSearchModel</db:link> which we can use to specify search parameters and perform a places search operation. For illustrative purposes, <db:link xlink:href="qml-qtlocation-placesearchmodel.xml#update-method">update</db:link>() is invoked once construction of the model is complete. Typically <db:link xlink:href="qml-qtlocation-placesearchmodel.xml#update-method">update</db:link>() would be invoked in response to a user action such as a button click.</db:para>
<db:programlisting language="qml">property variant locationOslo: QtPositioning.coordinate( 59.93, 10.76)

PlaceSearchModel {
    id: searchModel

    plugin: myPlugin

    searchTerm: &quot;Pizza&quot;
    searchArea: QtPositioning.circle(locationOslo)

    Component.onCompleted: update()
}
</db:programlisting>
<db:para>The map is displayed by using the <db:link xlink:href="qml-qtlocation-map.xml">Map</db:link> type and inside we declare the <db:link xlink:href="qml-qtlocation-mapitemview.xml">MapItemView</db:link> and supply the search model and a delegate. An inline delegate has been used and we have assumed that every search result is of <db:link xlink:href="qml-qtlocation-placesearchmodel.xml#search-result-types">type</db:link> <db:code>PlaceSerachesult</db:code>. Consequently it is assumed that we always have access to the <db:emphasis>place</db:emphasis> <db:link xlink:href="qml-qtlocation-placesearchmodel.xml#placesearchmodel-roles">role</db:link>, other search result types may not have a <db:emphasis>place</db:emphasis> <db:link xlink:href="qml-qtlocation-placesearchmodel.xml#placesearchmodel-roles">role</db:link>.</db:para>
<db:programlisting language="qml">Map {
    id: map
    anchors.fill: parent
    plugin: myPlugin;
    center: locationOslo
    zoomLevel: 13

    MapItemView {
        model: searchModel
        delegate: MapQuickItem {
            coordinate: place.location.coordinate

            anchorPoint.x: image.width * 0.5
            anchorPoint.y: image.height

            sourceItem: Column {
                Image { id: image; source: &quot;marker.png&quot; }
                Text { text: title; font.bold: true }
            }
        }
    }
}
</db:programlisting>
<db:para>Finally, a <db:code>PositionSource</db:code> is used to reset the map to the curent location and find &quot;pizza&quot; places in the new area. The position information is updated every 2 minutes and if the new position is more than 500 meters away from the last pizza search area the place search is retriggered.</db:para>
<db:programlisting language="qml">PositionSource {
    id: positionSource
    property variant lastSearchPosition: locationOslo
    active: true
    updateInterval: 120000 // 2 mins
    onPositionChanged:  {
        var currentPosition = positionSource.position.coordinate
        map.center = currentPosition
        var distance = currentPosition.distanceTo(lastSearchPosition)
        if (distance &amp;gt; 500) {
            // 500m from last performed pizza search
            lastSearchPosition = currentPosition
            searchModel.searchArea = QtPositioning.circle(currentPosition)
            searchModel.update()
        }
    }
}
</db:programlisting>
</db:section>
<db:section>
<db:title>List of Files</db:title>
<db:para>Files:</db:para>
<db:section>
<db:title>List of Files</db:title>
<db:itemizedlist>
<db:listitem>
<db:para><db:link xlink:href="places_map/main.cpp">places_map/main.cpp</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="places_map/places_map.pro">places_map/places_map.pro</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="places_map/places_map.qml">places_map/places_map.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="places_map/places_map.qrc">places_map/places_map.qrc</db:link></db:para></db:listitem>
</db:itemizedlist>
</db:section>
<db:section>
<db:title>List of Files</db:title>
<db:para>Images:</db:para>
<db:section>
<db:title>List of Files</db:title>
<db:itemizedlist>
<db:listitem>
<db:para><db:link xlink:href="places_map/marker.png">places_map/marker.png</db:link></db:para></db:listitem>
</db:itemizedlist>
</db:section>
</db:section></db:section></db:article>
