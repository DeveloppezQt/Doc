<?xml version="1.0" encoding="UTF-8"?>
<db:article xmlns:db="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.2" xml:lang="en_US">
<db:info>
<db:title>QXmlStream Bookmarks Example</db:title>
<db:productname>QtXml</db:productname>
<db:edition>Qt 5.2.1 Reference Documentation</db:edition>
<db:titleabbrev>Qt XML Reference Documentation</db:titleabbrev>
<db:abstract>
<db:para>Demonstrates how to read and write to XBEL files.</db:para>
</db:abstract>
<db:pubdate>2025-06-29</db:pubdate>
<db:date>2025-06-29</db:date>
<db:authorgroup>
<db:author>
<db:orgname class="corporation">The Qt Company Ltd.</db:orgname>
</db:author>
</db:authorgroup>
</db:info>
<db:para>The QXmlStream Bookmarks example provides a reader for XML Bookmark Exchange Language (XBEL) files using Qt's QXmlStreamReader class for reading, and QXmlStreamWriter class for writing the files.</db:para>
<db:mediaobject>
<db:imageobject>
<db:imagedata fileref="images/xmlstreamexample-screenshot.png"/>
</db:imageobject>
</db:mediaobject>
<db:section xml:id="xbelwriter-class-definition">
<db:title>XbelWriter Class Definition</db:title>
<db:para>The <db:code>XbelWriter</db:code> class contains a private instance of QXmlStreamWriter, which provides an XML writer with a streaming API. <db:code>XbelWriter</db:code> also has a reference to the QTreeWidget instance where the bookmark hierarchy is stored.</db:para>
<db:programlisting language="cpp">class XbelWriter
{
public:
    XbelWriter(QTreeWidget *treeWidget);
    bool writeFile(QIODevice *device);

private:
    void writeItem(QTreeWidgetItem *item);
    QXmlStreamWriter xml;
    QTreeWidget *treeWidget;
};
</db:programlisting>
</db:section>
<db:section xml:id="xbelwriter-class-implementation">
<db:title>XbelWriter Class Implementation</db:title>
<db:para>The <db:code>XbelWriter</db:code> constructor accepts a <db:code role="parameter">treeWidget</db:code> to initialize within its definition. We enable QXmlStreamWriter's auto-formatting property to ensure line-breaks and indentations are added automatically to empty sections between elements, increasing readability as the data is split into several lines.</db:para>
<db:programlisting language="cpp">XbelWriter::XbelWriter(QTreeWidget *treeWidget)
    : treeWidget(treeWidget)
{
    xml.setAutoFormatting(true);
}
</db:programlisting>
<db:para>The <db:code>writeFile()</db:code> function accepts a <db:link xlink:href="qiodevice.xml">QIODevice</db:link> object and sets it using <db:code>setDevice()</db:code>. This function then writes the document type definition(DTD), the start element, the version, and <db:code>treeWidget</db:code>'s top-level items.</db:para>
<db:programlisting language="cpp">bool XbelWriter::writeFile(QIODevice *device)
{
    xml.setDevice(device);

    xml.writeStartDocument();
    xml.writeDTD(&quot;&lt;!DOCTYPE xbel&gt;&quot;);
    xml.writeStartElement(&quot;xbel&quot;);
    xml.writeAttribute(&quot;version&quot;, &quot;1.0&quot;);
    for (int i = 0; i &lt; treeWidget-&gt;topLevelItemCount(); ++i)
        writeItem(treeWidget-&gt;topLevelItem(i));

    xml.writeEndDocument();
    return true;
}
</db:programlisting>
<db:para>The <db:code>writeItem()</db:code> function accepts a QTreeWidgetItem object and writes it to the stream, depending on its <db:code>tagName</db:code>, which can either be a &quot;folder&quot;, &quot;bookmark&quot;, or &quot;separator&quot;.</db:para>
<db:programlisting language="cpp">void XbelWriter::writeItem(QTreeWidgetItem *item)
{
    QString tagName = item-&gt;data(0, Qt::UserRole).toString();
    if (tagName == &quot;folder&quot;) {
        bool folded = !treeWidget-&gt;isItemExpanded(item);
        xml.writeStartElement(tagName);
        xml.writeAttribute(&quot;folded&quot;, folded ? &quot;yes&quot; : &quot;no&quot;);
        xml.writeTextElement(&quot;title&quot;, item-&gt;text(0));
        for (int i = 0; i &lt; item-&gt;childCount(); ++i)
            writeItem(item-&gt;child(i));
        xml.writeEndElement();
    } else if (tagName == &quot;bookmark&quot;) {
        xml.writeStartElement(tagName);
        if (!item-&gt;text(1).isEmpty())
            xml.writeAttribute(&quot;href&quot;, item-&gt;text(1));
        xml.writeTextElement(&quot;title&quot;, item-&gt;text(0));
        xml.writeEndElement();
    } else if (tagName == &quot;separator&quot;) {
        xml.writeEmptyElement(tagName);
    }
}
</db:programlisting>
</db:section>
<db:section xml:id="xbelreader-class-definition">
<db:title>XbelReader Class Definition</db:title>
<db:para>The <db:code>XbelReader</db:code> contains a private instance of QXmlStreamReader, the companion class to QXmlStreamWriter. <db:code>XbelReader</db:code> also contains a reference to the QTreeWidget that is used to group the bookmarks according to their hierarchy.</db:para>
<db:programlisting language="cpp">class XbelReader
{
public:
    XbelReader(QTreeWidget *treeWidget);

    bool read(QIODevice *device);

    QString errorString() const;

private:
    void readXBEL();
    void readTitle(QTreeWidgetItem *item);
    void readSeparator(QTreeWidgetItem *item);
    void readFolder(QTreeWidgetItem *item);
    void readBookmark(QTreeWidgetItem *item);

    QTreeWidgetItem *createChildItem(QTreeWidgetItem *item);

    QXmlStreamReader xml;
    QTreeWidget *treeWidget;

    QIcon folderIcon;
    QIcon bookmarkIcon;
};
</db:programlisting>
</db:section>
<db:section xml:id="xbelreader-class-implementation">
<db:title>XbelReader Class Implementation</db:title>
<db:para>The <db:code>XbelReader</db:code> constructor accepts a QTreeWidget to initialize the <db:code>treeWidget</db:code> within its definition. A QStyle object is used to set <db:code>treeWidget</db:code>'s style property. The <db:code>folderIcon</db:code> is set to QIcon::Normal mode where the pixmap is only displayed when the user is not interacting with the icon. The QStyle::SP_DirClosedIcon, QStyle::SP_DirOpenIcon, and QStyle::SP_FileIcon correspond to standard pixmaps that follow the style of your GUI.</db:para>
<db:programlisting language="cpp">XbelReader::XbelReader(QTreeWidget *treeWidget)
    : treeWidget(treeWidget)
{
    QStyle *style = treeWidget-&gt;style();

    folderIcon.addPixmap(style-&gt;standardPixmap(QStyle::SP_DirClosedIcon),
                         QIcon::Normal, QIcon::Off);
    folderIcon.addPixmap(style-&gt;standardPixmap(QStyle::SP_DirOpenIcon),
                         QIcon::Normal, QIcon::On);
    bookmarkIcon.addPixmap(style-&gt;standardPixmap(QStyle::SP_FileIcon));
}
</db:programlisting>
<db:para>The <db:code>read()</db:code> function accepts a <db:link xlink:href="qiodevice.xml">QIODevice</db:link> and sets it using <db:link xlink:href="">setDevice()</db:link>. The actual process of reading only takes place if the file is a valid XBEL 1.0 file. Note that the XML input needs to be well-formed to be accepted by QXmlStreamReader. Otherwise, the <db:link xlink:href="">raiseError()</db:link> function is used to display an error message. Since the XBEL reader is only concerned with reading XML elements, it makes extensive use of the <db:link xlink:href="">readNextStartElement()</db:link> convenience function.</db:para>
<db:programlisting language="cpp">bool XbelReader::read(QIODevice *device)
{
    xml.setDevice(device);

    if (xml.readNextStartElement()) {
        if (xml.name() == &quot;xbel&quot; &amp;&amp; xml.attributes().value(&quot;version&quot;) == &quot;1.0&quot;)
            readXBEL();
        else
            xml.raiseError(QObject::tr(&quot;The file is not an XBEL version 1.0 file.&quot;));
    }

    return !xml.error();
}
</db:programlisting>
<db:para>The <db:code>errorString()</db:code> function is used if an error occurred, in order to obtain a description of the error complete with line and column number information.</db:para>
<db:programlisting language="cpp">QString XbelReader::errorString() const
{
    return QObject::tr(&quot;%1\nLine %2, column %3&quot;)
            .arg(xml.errorString())
            .arg(xml.lineNumber())
            .arg(xml.columnNumber());
}
</db:programlisting>
<db:para>The <db:code>readXBEL()</db:code> function reads the name of a startElement and calls the appropriate function to read it, depending on whether if its a &quot;folder&quot;, &quot;bookmark&quot; or &quot;separator&quot;. Otherwise, it calls <db:link xlink:href="">skipCurrentElement()</db:link>. The <db:link xlink:href="qtglobal.xml#Q_ASSERT">Q_ASSERT</db:link>() macro is used to provide a pre-condition for the function.</db:para>
<db:programlisting language="cpp">void XbelReader::readXBEL()
{
    Q_ASSERT(xml.isStartElement() &amp;&amp; xml.name() == &quot;xbel&quot;);

    while (xml.readNextStartElement()) {
        if (xml.name() == &quot;folder&quot;)
            readFolder(0);
        else if (xml.name() == &quot;bookmark&quot;)
            readBookmark(0);
        else if (xml.name() == &quot;separator&quot;)
            readSeparator(0);
        else
            xml.skipCurrentElement();
    }
}
</db:programlisting>
<db:para>The <db:code>readTitle()</db:code> function reads the bookmark's title.</db:para>
<db:programlisting language="cpp">void XbelReader::readTitle(QTreeWidgetItem *item)
{
    Q_ASSERT(xml.isStartElement() &amp;&amp; xml.name() == &quot;title&quot;);

    QString title = xml.readElementText();
    item-&gt;setText(0, title);
}
</db:programlisting>
<db:para>The <db:code>readSeparator()</db:code> function creates a separator and sets its flags. The text is set to 30 &quot;0xB7&quot;, the HEX equivalent for period. The element is then skipped using <db:link xlink:href="">skipCurrentElement()</db:link>.</db:para>
<db:programlisting language="cpp">void XbelReader::readSeparator(QTreeWidgetItem *item)
{
    Q_ASSERT(xml.isStartElement() &amp;&amp; xml.name() == &quot;separator&quot;);

    QTreeWidgetItem *separator = createChildItem(item);
    separator-&gt;setFlags(item-&gt;flags() &amp; ~Qt::ItemIsSelectable);
    separator-&gt;setText(0, QString(30, 0xB7));
    xml.skipCurrentElement();
}
</db:programlisting>
</db:section>
<db:section xml:id="mainwindow-class-definition">
<db:title>MainWindow Class Definition</db:title>
<db:para>The <db:code>MainWindow</db:code> class is a subclass of QMainWindow, with a <db:code>File</db:code> menu and a <db:code>Help</db:code> menu.</db:para>
<db:programlisting language="cpp">class MainWindow : public QMainWindow
{
    Q_OBJECT

public:
    MainWindow();

public slots:
    void open();
    void saveAs();
    void about();

private:
    void createActions();
    void createMenus();

    QTreeWidget *treeWidget;

    QMenu *fileMenu;
    QMenu *helpMenu;
    QAction *openAct;
    QAction *saveAsAct;
    QAction *exitAct;
    QAction *aboutAct;
    QAction *aboutQtAct;
};
</db:programlisting>
</db:section>
<db:section xml:id="mainwindow-class-implementation">
<db:title>MainWindow Class Implementation</db:title>
<db:para>The <db:code>MainWindow</db:code> constructor instantiates the QTreeWidget object, <db:code>treeWidget</db:code> and sets its header with a <db:link xlink:href="qstringlist.xml">QStringList</db:link> object, <db:code>labels</db:code>. The constructor also invokes <db:code>createActions()</db:code> and <db:code>createMenus()</db:code> to set up the menus and their corresponding actions. The <db:code>statusBar()</db:code> is used to display the message &quot;Ready&quot; and the window's size is fixed to 480x320 pixels.</db:para>
<db:programlisting language="cpp">MainWindow::MainWindow()
{
    QStringList labels;
    labels &lt;&lt; tr(&quot;Title&quot;) &lt;&lt; tr(&quot;Location&quot;);

    treeWidget = new QTreeWidget;
    treeWidget-&gt;header()-&gt;setSectionResizeMode(QHeaderView::Stretch);
    treeWidget-&gt;setHeaderLabels(labels);
    setCentralWidget(treeWidget);

    createActions();
    createMenus();

    statusBar()-&gt;showMessage(tr(&quot;Ready&quot;));

    setWindowTitle(tr(&quot;QXmlStream Bookmarks&quot;));
    resize(480, 320);
}
</db:programlisting>
<db:para>The <db:code>open()</db:code> function enables the user to open an XBEL file using QFileDialog::getOpenFileName(). A warning message is displayed along with the <db:code>fileName</db:code> and <db:code>errorString</db:code> if the file cannot be read or if there is a parse error.</db:para>
<db:programlisting language="cpp">void MainWindow::open()
{
    QString fileName =
            QFileDialog::getOpenFileName(this, tr(&quot;Open Bookmark File&quot;),
                                         QDir::currentPath(),
                                         tr(&quot;XBEL Files (*.xbel *.xml)&quot;));
    if (fileName.isEmpty())
        return;

    treeWidget-&gt;clear();

    QFile file(fileName);
    if (!file.open(QFile::ReadOnly | QFile::Text)) {
        QMessageBox::warning(this, tr(&quot;QXmlStream Bookmarks&quot;),
                             tr(&quot;Cannot read file %1:\n%2.&quot;)
                             .arg(fileName)
                             .arg(file.errorString()));
        return;
    }

    XbelReader reader(treeWidget);
    if (!reader.read(&amp;file)) {
        QMessageBox::warning(this, tr(&quot;QXmlStream Bookmarks&quot;),
                             tr(&quot;Parse error in file %1:\n\n%2&quot;)
                             .arg(fileName)
                             .arg(reader.errorString()));
    } else {
        statusBar()-&gt;showMessage(tr(&quot;File loaded&quot;), 2000);
    }

}
</db:programlisting>
<db:para>The <db:code>saveAs()</db:code> function displays a QFileDialog, prompting the user for a <db:code>fileName</db:code> using QFileDialog::getSaveFileName(). Similar to the <db:code>open()</db:code> function, this function also displays a warning message if the file cannot be written to.</db:para>
<db:programlisting language="cpp">void MainWindow::saveAs()
{
    QString fileName =
            QFileDialog::getSaveFileName(this, tr(&quot;Save Bookmark File&quot;),
                                         QDir::currentPath(),
                                         tr(&quot;XBEL Files (*.xbel *.xml)&quot;));
    if (fileName.isEmpty())
        return;

    QFile file(fileName);
    if (!file.open(QFile::WriteOnly | QFile::Text)) {
        QMessageBox::warning(this, tr(&quot;QXmlStream Bookmarks&quot;),
                             tr(&quot;Cannot write file %1:\n%2.&quot;)
                             .arg(fileName)
                             .arg(file.errorString()));
        return;
    }

    XbelWriter writer(treeWidget);
    if (writer.writeFile(&amp;file))
        statusBar()-&gt;showMessage(tr(&quot;File saved&quot;), 2000);
}
</db:programlisting>
<db:para>The <db:code>about()</db:code> function displays a QMessageBox with a brief description of the example.</db:para>
<db:programlisting language="cpp">void MainWindow::about()
{
   QMessageBox::about(this, tr(&quot;About QXmlStream Bookmarks&quot;),
            tr(&quot;The &lt;b&gt;QXmlStream Bookmarks&lt;/b&gt; example demonstrates how to use Qt's &quot;
               &quot;QXmlStream classes to read and write XML documents.&quot;));
}
</db:programlisting>
<db:para>In order to implement the <db:code>open()</db:code>, <db:code>saveAs()</db:code>, <db:code>exit()</db:code>, <db:code>about()</db:code> and <db:code>aboutQt()</db:code> functions, we connect them to QAction objects and add them to the <db:code>fileMenu</db:code> and <db:code>helpMenu</db:code>. The connections are as shown below:</db:para>
<db:programlisting language="cpp">void MainWindow::createActions()
{
    openAct = new QAction(tr(&quot;&amp;Open...&quot;), this);
    openAct-&gt;setShortcuts(QKeySequence::Open);
    connect(openAct, SIGNAL(triggered()), this, SLOT(open()));

    saveAsAct = new QAction(tr(&quot;&amp;Save As...&quot;), this);
    saveAsAct-&gt;setShortcuts(QKeySequence::SaveAs);
    connect(saveAsAct, SIGNAL(triggered()), this, SLOT(saveAs()));

    exitAct = new QAction(tr(&quot;E&amp;xit&quot;), this);
    exitAct-&gt;setShortcuts(QKeySequence::Quit);
    connect(exitAct, SIGNAL(triggered()), this, SLOT(close()));

    aboutAct = new QAction(tr(&quot;&amp;About&quot;), this);
    connect(aboutAct, SIGNAL(triggered()), this, SLOT(about()));

    aboutQtAct = new QAction(tr(&quot;About &amp;Qt&quot;), this);
    connect(aboutQtAct, SIGNAL(triggered()), qApp, SLOT(aboutQt()));
}
</db:programlisting>
<db:para>The <db:code>createMenus()</db:code> function creates the <db:code>fileMenu</db:code> and <db:code>helpMenu</db:code> and adds the QAction objects to them in order to create the menu shown in the screenshot below:</db:para>
<db:informaltable style="generic">
<db:tr valign="top">
<db:td>
<db:para><db:inlinemediaobject>
<db:imageobject>
<db:imagedata fileref="images/xmlstreamexample-filemenu.png"/>
</db:imageobject>
</db:inlinemediaobject></db:para>
</db:td>
<db:td>
<db:para><db:inlinemediaobject>
<db:imageobject>
<db:imagedata fileref="images/xmlstreamexample-helpmenu.png"/>
</db:imageobject>
</db:inlinemediaobject></db:para>
</db:td>
</db:tr>
</db:informaltable>
<db:programlisting language="cpp">void MainWindow::createMenus()
{
    fileMenu = menuBar()-&gt;addMenu(tr(&quot;&amp;File&quot;));
    fileMenu-&gt;addAction(openAct);
    fileMenu-&gt;addAction(saveAsAct);
    fileMenu-&gt;addAction(exitAct);

    menuBar()-&gt;addSeparator();

    helpMenu = menuBar()-&gt;addMenu(tr(&quot;&amp;Help&quot;));
    helpMenu-&gt;addAction(aboutAct);
    helpMenu-&gt;addAction(aboutQtAct);
}
</db:programlisting>
</db:section>
<db:section xml:id="main-function">
<db:title><db:code>main()</db:code> Function</db:title>
<db:para>The <db:code>main()</db:code> function instantiates <db:code>MainWindow</db:code> and invokes the <db:code>show()</db:code> function.</db:para>
<db:programlisting language="cpp">int main(int argc, char *argv[])
{
    QApplication app(argc, argv);
    MainWindow mainWin;
    mainWin.show();
    mainWin.open();
    return app.exec();
}
</db:programlisting>
<db:para>See the <db:link xlink:href="http://pyxml.sourceforge.net/topics/xbel/">XML Bookmark Exchange Language Resource Page</db:link> for more information about XBEL files.</db:para>
</db:section>
<db:section>
<db:title>List of Files</db:title>
<db:para>Files:</db:para>
<db:section>
<db:title>List of Files</db:title>
<db:itemizedlist>
<db:listitem>
<db:para><db:link xlink:href="streambookmarks/main.cpp">streambookmarks/main.cpp</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="streambookmarks/mainwindow.cpp">streambookmarks/mainwindow.cpp</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="streambookmarks/mainwindow.h">streambookmarks/mainwindow.h</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="streambookmarks/streambookmarks.pro">streambookmarks/streambookmarks.pro</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="streambookmarks/xbelreader.cpp">streambookmarks/xbelreader.cpp</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="streambookmarks/xbelreader.h">streambookmarks/xbelreader.h</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="streambookmarks/xbelwriter.cpp">streambookmarks/xbelwriter.cpp</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="streambookmarks/xbelwriter.h">streambookmarks/xbelwriter.h</db:link></db:para></db:listitem>
</db:itemizedlist>
</db:section>
</db:section></db:article>
