<?xml version="1.0" encoding="UTF-8"?>
<db:article xmlns:db="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.2" xml:lang="en">
<db:info>
<db:title>JavaScript Host Environment</db:title>
<db:productname>QtQml</db:productname>
<db:edition>Qt 5.7.1 Reference Documentation</db:edition>
<db:titleabbrev>Qt QML Reference Documentation</db:titleabbrev>
<db:abstract>
<db:para>Description of the JavaScript host environment provided by the QML engine.</db:para>
</db:abstract>
<db:pubdate>2025-06-29</db:pubdate>
<db:date>2025-06-29</db:date>
<db:authorgroup>
<db:author>
<db:orgname class="corporation">The Qt Company Ltd.</db:orgname>
</db:author>
</db:authorgroup>
</db:info>
<db:para>QML provides a JavaScript host environment tailored to writing QML applications. This environment is different from the host environment provided by a browser or a server-side JavaScript environment such as Node.js. For example, QML does not provide a <db:code>window</db:code> object or <db:code>DOM API</db:code> as commonly found in a browser environment.</db:para>
<db:section xml:id="common-base">
<db:title>Common Base</db:title>
<db:para>Like a browser or server-side JavaScript environment, the QML runtime implements the <db:link xlink:href="http://www.ecma-international.org/publications/standards/Ecma-262.htm">ECMAScript Language Specification</db:link> standard. This provides access to all of the built-in types and functions defined by the standard, such as Object, Array, and Math. The QML runtime implements the 5th edition of the standard, which is the same edition commonly implemented by browsers.</db:para>
<db:para>The standard ECMAScript built-ins are not explicitly documented in the QML documentation. For more information on their use, please refer to the ECMA-262 5th edition standard or one of the many online JavaScript reference and tutorial sites, such as the <db:link xlink:href="http://www.w3schools.com/jsref/default.asp">W3Schools JavaScript Reference</db:link> (JavaScript Objects Reference section). Many sites focus on JavaScript in the browser, so in some cases you may need to double check the specification to determine whether a given function or object is part of standard ECMAScript or specific to the browser environment. In the case of the W3Schools link above, the <db:code>JavaScript Objects Reference</db:code> section generally covers the standard, while the <db:code>Browser Objects Reference</db:code> and <db:code>HTML DOM Objects Reference</db:code> sections are browser specific (and thus not applicable to QML).</db:para>
</db:section>
<db:section xml:id="qml-global-object">
<db:title>QML Global Object</db:title>
<db:para>The QML JavaScript host environment implements a number of host objects and functions, as detailed in the <db:link xlink:href="qtqml-javascript-qmlglobalobject.xml">QML Global Object</db:link> documentation.</db:para>
<db:para>These host objects and functions are always available, regardless of whether any modules have been imported.</db:para>
</db:section>
<db:section xml:id="javascript-objects-and-functions">
<db:title>JavaScript Objects and Functions</db:title>
<db:para>A list of the JavaScript objects, functions and properties supported by the QML engine can be found in the <db:link xlink:href="qtqml-javascript-functionlist.xml">List of JavaScript Objects and Functions</db:link>.</db:para>
<db:para>Note that QML makes the following modifications to native objects:</db:para>
<db:itemizedlist>
<db:listitem>
<db:para>An <db:link xlink:href="qml-qtqml-string.xml#arg-method">arg</db:link>() function is added to the <db:link xlink:href="qml-qtqml-string.xml">String</db:link> prototype.</db:para>
</db:listitem>
<db:listitem>
<db:para>Locale-aware conversion functions are added to the <db:link xlink:href="qml-qtqml-date.xml">Date</db:link> and <db:link xlink:href="qml-qtqml-number.xml">Number</db:link> prototypes.</db:para>
</db:listitem>
</db:itemizedlist>
</db:section>
<db:section xml:id="javascript-environment-restrictions">
<db:title>JavaScript Environment Restrictions</db:title>
<db:para>QML implements the following restrictions for JavaScript code:</db:para>
<db:itemizedlist>
<db:listitem>
<db:para>JavaScript code written in a <db:code>.qml</db:code> file cannot modify the global object. JavaScript code in a .js file can modify the global object, and those modifications will be visible to the .qml file when <db:link xlink:href="qtqml-javascript-imports.xml#importing-a-javascript-resource-from-a-qml-document">imported</db:link>.</db:para>
<db:para>In QML, the global object is constant - existing properties cannot be modified or deleted, and no new properties may be created.</db:para>
<db:para>Most JavaScript programs do not intentionally modify the global object. However, JavaScript's automatic creation of undeclared variables is an implicit modification of the global object, and is prohibited in QML.</db:para>
<db:para>Assuming that the <db:code>a</db:code> variable does not exist in the scope chain, the following code is illegal in QML:</db:para>
<db:programlisting language="cpp">// Illegal modification of undeclared variable
a = 1;
for (var ii = 1; ii &lt; 10; ++ii)
    a = a * ii;
console.log(&quot;Result: &quot; + a);
</db:programlisting>
<db:para>It can be trivially modified to this legal code.</db:para>
<db:programlisting language="cpp">var a = 1;
for (var ii = 1; ii &lt; 10; ++ii)
    a = a * ii;
console.log(&quot;Result: &quot; + a);
</db:programlisting>
<db:para>Any attempt to modify the global object - either implicitly or explicitly - will cause an exception. If uncaught, this will result in a warning being printed, that includes the file and line number of the offending code.</db:para>
</db:listitem>
<db:listitem>
<db:para>Global code is run in a reduced scope.</db:para>
<db:para>During startup, if a QML file includes an external JavaScript file with &quot;global&quot; code, it is executed in a scope that contains only the external file itself and the global object. That is, it will not have access to the QML objects and properties it <db:link xlink:href="qtqml-documents-scope.xml">normally would</db:link>.</db:para>
<db:para>Global code that only accesses script local variables is permitted. This is an example of valid global code.</db:para>
<db:programlisting language="cpp">var colors = [ &quot;red&quot;, &quot;blue&quot;, &quot;green&quot;, &quot;orange&quot;, &quot;purple&quot; ];
</db:programlisting>
<db:para>Global code that accesses QML objects will not run correctly.</db:para>
<db:programlisting language="cpp">// Invalid global code - the &quot;rootObject&quot; variable is undefined
var initialPosition = { rootObject.x, rootObject.y }
</db:programlisting>
<db:para>This restriction exists as the QML environment is not yet fully established. To run code after the environment setup has completed, see <db:link xlink:href="qtqml-javascript-expressions.xml#javascript-in-application-startup-code">JavaScript in Application Startup Code</db:link>.</db:para>
</db:listitem>
<db:listitem>
<db:para>The value of <db:code>this</db:code> is currently undefined in QML in the majority of contexts.</db:para>
<db:para>The <db:code>this</db:code> keyword is supported when binding properties from JavaScript. In all other situations, the value of <db:code>this</db:code> is undefined in QML.</db:para>
<db:para>To refer to a specific object, provide an <db:code>id</db:code>. For example:</db:para>
<db:programlisting language="qml">Item {
    width: 200; height: 100
    function mouseAreaClicked(area) {
        console.log(&quot;Clicked in area at: &quot; + area.x + &quot;, &quot; + area.y);
    }
    // This will not work because this is undefined
    MouseArea {
        height: 50; width: 200
        onClicked: mouseAreaClicked(this)
    }
    // This will pass area2 to the function
    MouseArea {
        id: area2
        y: 50; height: 50; width: 200
        onClicked: mouseAreaClicked(area2)
    }
}
</db:programlisting>
</db:listitem>
</db:itemizedlist>
</db:section>
</db:article>
