<?xml version="1.0" encoding="UTF-8"?>
<db:article xmlns:db="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.2" xml:lang="en">
<db:info>
<db:title>Porting C++ Applications to Qt 6 using Clazy checks</db:title>
<db:productname>QtDoc</db:productname>
<db:edition>Qt 6.1.3 Reference Documentation</db:edition>
<db:titleabbrev>Qt Reference Documentation</db:titleabbrev>
<db:abstract>
<db:para>Qt Reference Documentation.</db:para></db:abstract>
<db:pubdate>2024-12-27</db:pubdate>
<db:date>2024-12-27</db:date>
<db:authorgroup>
<db:author>
<db:orgname class="corporation">The Qt Company Ltd.</db:orgname>
</db:author>
</db:authorgroup>
</db:info>
<db:para>We've implemented some checks and fixits within the Clazy framework to help you port your applications from Qt 5 to Qt 6. In their own words: &quot;Clazy is a compiler plugin which allows clang to understand Qt semantics&quot;. Get Clazy (<db:link xlink:href="https://invent.kde.org/sdk/clazy">https://invent.kde.org/sdk/clazy</db:link>) and read on to make porting to Qt 6 smoother.</db:para>
<db:para>Clazy checks can be run as a plugin during compilation or over a JSON compilation database using clazy-standalone. The fixes are applied later, using clang-apply-replacements.</db:para>
<db:section xml:id="clazy-checks-dedicated-to-qt-6-porting">
<db:title>Clazy checks dedicated to Qt 6 porting</db:title>
<db:para>The following checks are dedicated to ease the port from Qt 5 to Qt 6.</db:para>
<db:itemizedlist>
<db:listitem>
<db:para>qt6-deprecated-api-fixes</db:para>
</db:listitem>
<db:listitem>
<db:para>qt6-header-fixes</db:para>
</db:listitem>
<db:listitem>
<db:para>qt6-qhash-signature</db:para>
</db:listitem>
<db:listitem>
<db:para>qt6-qlatin1stringchar-to-u</db:para>
</db:listitem>
<db:listitem>
<db:para>qt6-fwd-fixes</db:para>
</db:listitem>
</db:itemizedlist>
<db:para>The checks have to be run against Qt 5. The fixed code is only going to compile against Qt 6. For this reason the above mentioned checks have to be run in one go. Clazy recommends running one test at a time to avoid conflict when applying fixes, but this is not an option when running those checks as a plugin.</db:para>
</db:section>
<db:section xml:id="how-to-apply-clazy-checks">
<db:title>How to apply Clazy checks</db:title>
<db:para>How to set up your project to run with Clazy and how to select and apply the checks is fully explained here: <db:link xlink:href="https://invent.kde.org/sdk/clazy#setting-up-your-project-to-build-with-clazy">https://invent.kde.org/sdk/clazy#setting-up-your-project-to-build-with-clazy</db:link>.</db:para>
<db:para>If you don't want to run the checks as a plugin but rather over a JSON compilation database, you need to use clazy-standalone. Please see <db:link xlink:href="https://invent.kde.org/sdk/clazy#clazy-standalone-and-json-database-support">https://invent.kde.org/sdk/clazy#clazy-standalone-and-json-database-support</db:link> for instructions.</db:para>
<db:para>In a nutshell, assuming you have an up to date Clazy version installed, what needs to be done to run the checks as a plugin is explained below.</db:para>
<db:para>Set up your project to run with Clazy.</db:para>
<db:section xml:id="if-using-qmake">
<db:title>If using qmake</db:title>
<db:para>Add the following lines to your qmake command, as appropriate for your OS:</db:para>
<db:programlisting language="cpp">-spec linux-clang QMAKE_CXX=&quot;clazy&quot;
-spec macx-clang QMAKE_CXX=&quot;clazy&quot;
</db:programlisting>
<db:para>For Windows with MSVC add QMAKE_CXX=&quot;clazy-cl.bat&quot;.</db:para>
<db:para>Run qmake.</db:para>
</db:section>
<db:section xml:id="if-using-cmake">
<db:title>If using CMake</db:title>
<db:para>Add: --DCMAKE_CXX_COMPILER=clazy to the cmake command.</db:para>
<db:para>Run cmake.</db:para>
<db:para>Select the checks:</db:para>
<db:programlisting language="cpp">export CLAZY_CHECKS=&quot;qt6-deprecated-api-fixes, qt6-header-fixes,
qt6-qhash-signature, qt6-qlatin1stringchar-to-u, qt6-fwd-fixes&quot;
</db:programlisting>
<db:para>Enable the fixits:</db:para>
<db:programlisting language="cpp">export CLAZY_EXPORT_FIXES=ON
</db:programlisting>
<db:para>Set the directories to be ignored by Clazy:</db:para>
<db:programlisting language="cpp">export CLAZY_IGNORE_DIRS=.*lib_dir.*
</db:programlisting>
<db:para>This will prevent Clazy checks from running on the libraries' files. This is necessary if the libraries' paths are included with -I and -F instead of -isystem and -framework. This is also necessary to avoid warnings from qt-header-fixes check, if the headers triggering the check are included in the included libraries' files.</db:para>
<db:para>Compile your code.</db:para>
<db:para>During compilation .yaml files are created next to the source files.</db:para>
<db:para>To apply the fixits, run:</db:para>
<db:programlisting language="cpp">clang-apply-replacements &amp;lt;path_to_yaml_files&amp;gt;
</db:programlisting>
<db:para>This will modify the source files, consider backing up your code.</db:para>
<db:para>Not all porting can be done with automatic fixits. Please look carefully at the warnings during compilation for the code that will have to be changed manually.</db:para>
</db:section>
</db:section>
</db:article>
