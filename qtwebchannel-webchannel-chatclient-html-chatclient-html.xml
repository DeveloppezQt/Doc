<?xml version="1.0" encoding="UTF-8"?>
<db:article xmlns:db="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.2" xml:lang="en">
<db:info>
<db:title>Qt WebChannel ChatClient HTML Example</db:title>
<db:productname>QtWebChannel</db:productname>
<db:edition>Qt 5.12.12 Reference Documentation</db:edition>
<db:titleabbrev>Qt WebChannel Reference Documentation</db:titleabbrev>
<db:abstract>
<db:para>A HTML/JavaScript client that communicates over a <db:link xlink:href="qml-qtwebsockets-websocket.xml">WebSocket</db:link> with a <db:link xlink:href="qwebchannel.xml">QWebChannel</db:link> server.</db:para>
</db:abstract>
<db:pubdate>2024-12-27</db:pubdate>
<db:date>2024-12-27</db:date>
<db:authorgroup>
<db:author>
<db:orgname class="corporation">The Qt Company Ltd.</db:orgname>
</db:author>
</db:authorgroup>
</db:info>
<db:programlisting language="cpp">&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html&amp;gt;
&amp;lt;head&amp;gt;
    &amp;lt;title&amp;gt;ChatClient&amp;lt;/title&amp;gt;

    &amp;lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot; /&amp;gt;

    &amp;lt;link rel=&quot;stylesheet&quot; href=&quot;http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.css&quot; /&amp;gt;
    &amp;lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;http://www.jeasyui.com/easyui/themes/default/easyui.css&quot; /&amp;gt;
    &amp;lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;http://www.jeasyui.com/easyui/themes/icon.css&quot; /&amp;gt;
    &amp;lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;http://www.jeasyui.com/easyui/demo/demo.css&quot; /&amp;gt;
    &amp;lt;script src=&quot;http://code.jquery.com/jquery-1.9.1.js&quot;&amp;gt;&amp;lt;/script&amp;gt;
    &amp;lt;script type=&quot;text/javascript&quot; src=&quot;http://www.jeasyui.com/easyui/jquery.easyui.min.js&quot;&amp;gt;&amp;lt;/script&amp;gt;
    &amp;lt;script type=&quot;text/javascript&quot; src=&quot;qwebchannel.js&quot;&amp;gt;&amp;lt;/script&amp;gt;

    &amp;lt;script&amp;gt;
        'use strict';
        var wsUri = &quot;ws://localhost:12345&quot;;
        window.loggedin = false;

        window.onload = function() {
            var socket = new WebSocket(wsUri);

            socket.onclose = function() {
                console.error(&quot;web channel closed&quot;);
            };
            socket.onerror = function(error) {
                console.error(&quot;web channel error: &quot; + error);
            };
            socket.onopen = function() {
                window.channel = new QWebChannel(socket, function(channel) {
                    //connect to the changed signal of a property
                    channel.objects.chatserver.userListChanged.connect(function() {
                        $('#userlist').empty();
                        //access the property
                        channel.objects.chatserver.userList.forEach(function(user) {
                            $('#userlist').append(user + '&amp;lt;br&amp;gt;');
                        });
                    });
                    //connect to a signal
                    channel.objects.chatserver.newMessage.connect(function(time, user, message) {
                        $('#chat').append(&quot;[&quot; + time + &quot;] &quot; + user + &quot;: &quot; + message + '&amp;lt;br&amp;gt;');
                    });
                    //connect to a signal
                    channel.objects.chatserver.keepAlive.connect(function(args) {
                        if (window.loggedin) {
                            //call a method
                            channel.objects.chatserver.keepAliveResponse($('#loginname').val())
                            console.log(&quot;sent alive&quot;);
                        }
                    });

                });
            }
        }
    &amp;lt;/script&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;

&amp;lt;div id=&quot;loginDialog&quot; class=&quot;easyui-dialog&quot; title=&quot;Chat Login&quot; data-options=&quot;iconCls:'icon-save'&quot; style=&quot;width:400px;height:200px;padding:10px&quot;&amp;gt;
    &amp;lt;form id=&quot;loginForm&quot; method=&quot;post&quot;&amp;gt;
        &amp;lt;table cellpadding=&quot;5&quot;&amp;gt;
        &amp;lt;tr&amp;gt;&amp;lt;td&amp;gt;Name:&amp;lt;/td&amp;gt;&amp;lt;td&amp;gt;&amp;lt;input class=&quot;easyui-validatebox&quot; type=&quot;text&quot; id=&quot;loginname&quot; name=&quot;name&quot; data-options=&quot;required:true&quot;&amp;gt;&amp;lt;/input&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
        &amp;lt;/table&amp;gt;
    &amp;lt;/form&amp;gt;
    &amp;lt;div style=&quot;text-align:center;padding:5px&quot;&amp;gt;
        &amp;lt;a href=&quot;javascript:void(0)&quot; class=&quot;easyui-linkbutton&quot; onclick=&quot;submitForm()&quot;&amp;gt;Login&amp;lt;/a&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;div style=&quot;text-align:center;padding:5px&quot; id=&quot;loginError&quot;&amp;gt;
        Username already in use.
    &amp;lt;/div&amp;gt;
    &amp;lt;script&amp;gt;
    $('#loginForm').submit(submitForm);

    function submitForm(event) {
        console.log(&quot;DEBUG login: &quot; + channel);
        channel.objects.chatserver.login($('#loginname').val(), function(arg) {
            console.log(&quot;DEBUG login response: &quot; + arg);
            if (arg === true) {
                $('#loginError').hide();
                $('#loginDialog').dialog('close');
                window.loggedin = true;
            } else {
                $('#loginError').show();
            }
        });
        console.log($('#loginname').val());
        if (event !== undefined)
            event.preventDefault();
        return false;
    }
    &amp;lt;/script&amp;gt;
&amp;lt;/div&amp;gt;

&amp;lt;div class=&quot;easyui-layout&quot; style=&quot;width:500px;height:300px;&quot;&amp;gt;
    &amp;lt;div data-options=&quot;region:'east',split:true&quot; title=&quot;Users&quot; id=&quot;userlist&quot; style=&quot;width:100px;&quot;&amp;gt;

    &amp;lt;/div&amp;gt;
    &amp;lt;div data-options=&quot;region:'south',split:true&quot; style=&quot;height:50px;&quot;&amp;gt;
        &amp;lt;form id=&quot;messageForm&quot;&amp;gt;
            &amp;lt;input class=&quot;easyui-validatebox&quot; type=&quot;text&quot; id=&quot;message&quot; name=&quot;name&quot; style=&quot;width: 97%&quot;&amp;gt;&amp;lt;/input&amp;gt;
        &amp;lt;/form&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;div data-options=&quot;region:'center'&quot; id=&quot;chat&quot;&amp;gt;

    &amp;lt;/div&amp;gt;
    &amp;lt;script&amp;gt;
    $('#messageForm').submit(submitMessage);

    function submitMessage(event) {
        channel.objects.chatserver.sendMessage($('#loginname').val(), $('#message').val());
        $('#message').val('');
        if (event !== undefined)
            event.preventDefault();
        return false;
    }
    &amp;lt;/script&amp;gt;
&amp;lt;/div&amp;gt;

&amp;lt;script type=&quot;text/javascript&quot;&amp;gt;
$(document).ready(function() {
    $('#loginError').hide();
});
&amp;lt;/script&amp;gt;

&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;

</db:programlisting>
</db:article>
