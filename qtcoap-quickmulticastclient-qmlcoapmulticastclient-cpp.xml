<?xml version="1.0" encoding="UTF-8"?>
<db:article xmlns:db="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.2" xml:lang="en">
<db:info>
<db:title>Quick CoAP Multicast Discovery Example</db:title>
<db:productname>QtCoap</db:productname>
<db:edition>Qt 6.4.3 Reference Documentation</db:edition>
<db:titleabbrev>Qt CoAP Reference Documentation</db:titleabbrev>
<db:abstract>
<db:para>Using the CoAP client for a multicast resource discovery with a Qt Quick user interface.</db:para>
</db:abstract>
<db:pubdate>2024-01-26</db:pubdate>
<db:date>2024-01-26</db:date>
<db:authorgroup>
<db:author>
<db:orgname class="corporation">The Qt Company Ltd.</db:orgname>
</db:author>
</db:authorgroup>
</db:info>
<db:programlisting language="cpp">// Copyright (C) 2019 The Qt Company Ltd.
// SPDX-License-Identifier: LicenseRef-Qt-Commercial OR BSD-3-Clause

#include &quot;qmlcoapmulticastclient.h&quot;

#include &amp;lt;QCoapResourceDiscoveryReply&amp;gt;
#include &amp;lt;QLoggingCategory&amp;gt;

Q_LOGGING_CATEGORY(lcCoapClient, &quot;qt.coap.client&quot;)

QmlCoapMulticastClient::QmlCoapMulticastClient(QObject *parent)
    : QCoapClient(QtCoap::SecurityMode::NoSecurity, parent)
{
    connect(this, &amp;amp;QCoapClient::finished, this,
            [this](QCoapReply *reply) {
                    if (reply)
                        emit finished(static_cast&amp;lt;int&amp;gt;(reply-&amp;gt;errorReceived()));
                    else
                        qCWarning(lcCoapClient, &quot;Something went wrong, received a null reply&quot;);
            });
}

void QmlCoapMulticastClient::discover(const QString &amp;amp;host, int port, const QString &amp;amp;discoveryPath)
{
    QUrl url;
    url.setHost(host);
    url.setPort(port);

    QCoapResourceDiscoveryReply *discoverReply = QCoapClient::discover(url, discoveryPath);
    if (discoverReply) {
        connect(discoverReply, &amp;amp;QCoapResourceDiscoveryReply::discovered,
                this, &amp;amp;QmlCoapMulticastClient::onDiscovered);
    } else {
        qCWarning(lcCoapClient, &quot;Discovery request failed.&quot;);
    }
}

void QmlCoapMulticastClient::discover(QtCoap::MulticastGroup group, int port,
                                      const QString &amp;amp;discoveryPath)
{
    QCoapResourceDiscoveryReply *discoverReply = QCoapClient::discover(group, port, discoveryPath);
    if (discoverReply) {
        connect(discoverReply, &amp;amp;QCoapResourceDiscoveryReply::discovered,
                this, &amp;amp;QmlCoapMulticastClient::onDiscovered);
    } else {
        qCWarning(lcCoapClient, &quot;Discovery request failed.&quot;);
    }
}

void QmlCoapMulticastClient::onDiscovered(QCoapResourceDiscoveryReply *reply,
                                          const QList&amp;lt;QCoapResource&amp;gt; &amp;amp;resources)
{
    Q_UNUSED(reply)
    for (auto resource : resources)
        emit discovered(resource);
}

</db:programlisting>
</db:article>
