<?xml version="1.0" encoding="UTF-8"?>
<db:article xmlns:db="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.2" xml:lang="en_US">
<db:info>
<db:title>Chapter 6: Writing an Extension Plugin</db:title>
<db:productname>QtQml</db:productname>
<db:edition>Qt 5.2.1 Reference Documentation</db:edition>
<db:titleabbrev>Qt QML Reference Documentation</db:titleabbrev>
<db:abstract>
<db:para>Qt QML Reference Documentation.</db:para></db:abstract>
<db:pubdate>2025-06-29</db:pubdate>
<db:date>2025-06-29</db:date>
<db:authorgroup>
<db:author>
<db:orgname class="corporation">The Qt Company Ltd.</db:orgname>
</db:author>
</db:authorgroup>
</db:info>
<db:para>Currently the <db:code>PieChart</db:code> and <db:code>PieSlice</db:code> types are used by <db:code>app.qml</db:code>, which is displayed using a QQuickView in a C++ application. An alternative way to use our QML extension is to create a plugin library to make it available to the QML engine as a new QML import module. This allows the <db:code>PieChart</db:code> and <db:code>PieSlice</db:code> types to be registered into a type namespace which can be imported by any QML application, instead of restricting these types to be only used by the one application.</db:para>
<db:para>The steps for creating a plugin are described in <db:link xlink:href="qtqml-modules-cppplugins.xml">Creating C++ Plugins for QML</db:link>. To start with, we create a plugin class named <db:code>ChartsPlugin</db:code>. It subclasses QQmlExtensionPlugin and registers our QML types in the inherited <db:link xlink:href="">registerTypes()</db:link> method.</db:para>
<db:para>Here is the <db:code>ChartsPlugin</db:code> definition in <db:code>chartsplugin.h</db:code>:</db:para>
<db:programlisting language="cpp">#include &lt;QQmlExtensionPlugin&gt;

class ChartsPlugin : public QQmlExtensionPlugin
{
    Q_OBJECT
    Q_PLUGIN_METADATA(IID &quot;org.qt-project.Qt.QQmlExtensionInterface&quot;)

public:
    void registerTypes(const char *uri);
};
</db:programlisting>
<db:para>And its implementation in <db:code>chartsplugin.cpp</db:code>:</db:para>
<db:programlisting language="cpp">#include &quot;piechart.h&quot;
#include &quot;pieslice.h&quot;
#include &lt;qqml.h&gt;

void ChartsPlugin::registerTypes(const char *uri)
{
    qmlRegisterType&lt;PieChart&gt;(uri, 1, 0, &quot;PieChart&quot;);
    qmlRegisterType&lt;PieSlice&gt;(uri, 1, 0, &quot;PieSlice&quot;);
}

</db:programlisting>
<db:para>Then, we write a <db:code>.pro</db:code> project file that defines the project as a plugin library and specifies with DESTDIR that library files should be built into a <db:code>../Charts</db:code> directory.</db:para>
<db:programlisting language="cpp">TEMPLATE = lib
CONFIG += plugin
QT += qml quick

DESTDIR = ../Charts
TARGET = $$qtLibraryTarget(chartsplugin)

HEADERS += piechart.h \
           pieslice.h \
           chartsplugin.h

SOURCES += piechart.cpp \
           pieslice.cpp \
           chartsplugin.cpp

DESTPATH=$$[QT_INSTALL_EXAMPLES]/qml/tutorials/extending/chapter6-plugins/Charts

target.path=$$DESTPATH
qmldir.files=$$PWD/qmldir
qmldir.path=$$DESTPATH
INSTALLS += target qmldir

OTHER_FILES += qmldir

# Copy the qmldir file to the same folder as the plugin binary
QMAKE_POST_LINK += $$QMAKE_COPY $$replace($$list($$quote($$PWD/qmldir) $$DESTDIR), /, $$QMAKE_DIR_SEP)

</db:programlisting>
<db:para>In this example, the <db:code>Charts</db:code> directory is located at the same level as the application that uses our new import module. This way, the QML engine will find our module as the default search path for QML imports includes the directory of the application executable. Alternatively, we could control what directories the <db:link xlink:href="qtqml-syntax-imports.xml#qml-import-path">QML import path</db:link> contains, useful if there are multiple QML applications using the same QML imports.</db:para>
<db:para>The <db:code>.pro</db:code> file also contains additional magic to ensure that the <db:link xlink:href="qtqml-modules-qmldir.xml">module definition qmldir file</db:link> is always copied to the same location as the plugin binary.</db:para>
<db:para>The <db:code>qmldir</db:code> file declares the module name and the plugin that is made available by the module:</db:para>
<db:programlisting language="cpp">module Charts
plugin chartsplugin

</db:programlisting>
<db:para>Now we have a QML module that can be imported to any application, provided that the QML engine knows where to find it. The example contains an executable that loads <db:code>app.qml</db:code>, which uses the <db:code>import Charts 1.0</db:code> statement. Alternatively, you can load the QML file using the <db:link xlink:href="">qmlscene tool</db:link>, setting the import path to the current directory so that it finds the <db:code>qmldir</db:code> file:</db:para>
<db:programlisting language="cpp">qmlscene -I . app.qml
</db:programlisting>
<db:para>The module &quot;Charts&quot; will be loaded by the QML engine, and the types provided by that module will be available for use in any QML document which imports it.</db:para>
<db:section>
<db:title>List of Files</db:title>
<db:para>Files:</db:para>
<db:section>
<db:title>List of Files</db:title>
<db:itemizedlist>
<db:listitem>
<db:para><db:link xlink:href="tutorials/extending/chapter6-plugins/app.pro">tutorials/extending/chapter6-plugins/app.pro</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="tutorials/extending/chapter6-plugins/app.qml">tutorials/extending/chapter6-plugins/app.qml</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="tutorials/extending/chapter6-plugins/app.qrc">tutorials/extending/chapter6-plugins/app.qrc</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="tutorials/extending/chapter6-plugins/chapter6-plugins.pro">tutorials/extending/chapter6-plugins/chapter6-plugins.pro</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="tutorials/extending/chapter6-plugins/import/chartsplugin.cpp">tutorials/extending/chapter6-plugins/import/chartsplugin.cpp</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="tutorials/extending/chapter6-plugins/import/chartsplugin.h">tutorials/extending/chapter6-plugins/import/chartsplugin.h</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="tutorials/extending/chapter6-plugins/import/import.pro">tutorials/extending/chapter6-plugins/import/import.pro</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="tutorials/extending/chapter6-plugins/import/piechart.cpp">tutorials/extending/chapter6-plugins/import/piechart.cpp</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="tutorials/extending/chapter6-plugins/import/piechart.h">tutorials/extending/chapter6-plugins/import/piechart.h</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="tutorials/extending/chapter6-plugins/import/pieslice.cpp">tutorials/extending/chapter6-plugins/import/pieslice.cpp</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="tutorials/extending/chapter6-plugins/import/pieslice.h">tutorials/extending/chapter6-plugins/import/pieslice.h</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="tutorials/extending/chapter6-plugins/import/qmldir">tutorials/extending/chapter6-plugins/import/qmldir</db:link></db:para></db:listitem>
<db:listitem>
<db:para><db:link xlink:href="tutorials/extending/chapter6-plugins/main.cpp">tutorials/extending/chapter6-plugins/main.cpp</db:link></db:para></db:listitem>
</db:itemizedlist>
</db:section>
</db:section></db:article>
